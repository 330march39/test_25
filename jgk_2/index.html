<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>情報学基礎論II テスト対策アプリ (5年分収録)</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #f8fafc;
            overscroll-behavior-y: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Custom Animations */
        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up {
            animation: fade-in-up 0.5s ease-out forwards;
        }

        @keyframes pulse-soft {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        .animate-pulse-soft {
            animation: pulse-soft 2s infinite;
        }

        /* Hide scrollbar */
        ::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icons ---
        const Zap = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>;
        const Award = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>;
        const TrendingUp = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>;
        const BookOpen = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>;
        const CheckCircle = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>;
        const XCircle = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>;
        const ChevronRight = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polyline points="9 18 15 12 9 6"/></svg>;
        const Home = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>;
        const Lock = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>;

        // --- Data: 5 Years of Exam Sets ---
        const EXAM_SETS = [
            {
                id: 'set1',
                title: '第1回：基礎理論とデジタル',
                subtitle: 'アナログ/デジタル・原子構造',
                difficulty: '★☆☆',
                questions: [
                    {
                        category: 'デジタル',
                        text: '現実世界における「デジタル情報」の性質として、講義資料で説明されている内容はどれ？',
                        options: ['理論的にも物理的にも絶対に劣化しない', '物理的な状態(電荷や磁気)で保存されるため、環境により劣化・消失のリスクがある', 'アナログ信号よりもノイズに弱く、コピーを作成できない', '一度デジタル化すれば、媒体が破損してもデータは読み出せる'],
                        correctIndex: 1,
                        explanation: 'デジタル値自体は劣化しませんが、それを記録する物理媒体（電荷、磁気、凹凸）は熱や経年劣化の影響を受けます。(Slide 4)'
                    },
                    {
                        category: '電気の正体',
                        text: '原子において、原子核の周りを回っている「負の電荷」を持つ粒子は何？',
                        options: ['陽子 (Proton)', '中性子 (Neutron)', '電子 (Electron)', '光子 (Photon)'],
                        correctIndex: 2,
                        explanation: '負の電荷を持つのは電子です。陽子は正の電荷を持ちます。通常、陽子と電子の数が等しく電気的に中和しています。(Slide 9)'
                    },
                    {
                        category: '自由電子',
                        text: '金属結合において、原子核の束縛を離れて自由に動き回ることができる電子を何と呼ぶ？',
                        options: ['価電子', '自由電子', '陽イオン', '絶縁電子'],
                        correctIndex: 1,
                        explanation: '最外殻の電子がエネルギーを得て動き回れるようになったものを「自由電子」と呼び、これが電流の正体となります。(Slide 9)'
                    },
                    {
                        category: '電流の定義',
                        text: '電流の単位「アンペア(A)」の定義に関連する記述として正しいものは？',
                        options: ['1秒間に1クーロンの電荷が流れるときの電流', '1秒間に1ボルトの電圧がかかるときの電流', '電子1個が1秒間に移動する速度', '抵抗1オームに10ボルトかけた時の電流'],
                        correctIndex: 0,
                        explanation: '電流I = Q/t。つまり毎秒1クーロン(C)の電荷を流す電流が1アンペア(A)と定義されます。(Slide 10)'
                    },
                    {
                        category: '電流の向き',
                        text: '回路図における電流の向きと、実際の電子の移動方向の関係は？',
                        options: ['同じ方向である', '逆方向である', '直角に交わる', '関係はない'],
                        correctIndex: 1,
                        explanation: '電流はプラスからマイナスへ流れると定義されていますが、電子はマイナスからプラスへ移動します。歴史的な経緯で逆になっています。(Slide 11)'
                    }
                ]
            },
            {
                id: 'set2',
                title: '第2回：基本法則と物質',
                subtitle: 'オームの法則・導体/絶縁体',
                difficulty: '★★☆',
                questions: [
                    {
                        category: '電圧',
                        text: '電気的な位置エネルギーの差であり、電流を流そうとする圧力を何と呼ぶ？',
                        options: ['電力 (Watt)', '電位差・電圧 (Volt)', '抵抗 (Ohm)', '静電容量 (Farad)'],
                        correctIndex: 1,
                        explanation: '水圧に例えられる、電流を流そうとする働きを電圧（電位差）と呼びます。(Slide 12)'
                    },
                    {
                        category: '電池の接続',
                        text: '1.5Vの乾電池を2つ「直列」につないだ場合、全体の電圧は何Vになる？',
                        options: ['1.5V', '3.0V', '0.75V', '変わらない'],
                        correctIndex: 1,
                        explanation: '電池を直列につなぐと、起電力（電圧）は和になります。1.5V + 1.5V = 3.0V です。(Slide 13)'
                    },
                    {
                        category: '抵抗',
                        text: '抵抗（電気抵抗）の説明として正しいものは？',
                        options: ['電子の流れを促進する性質', '電流の流れを妨げ、電気エネルギーを熱に変える性質', '電圧を電流に変換する装置', '温度が上がると必ず抵抗値が下がる性質'],
                        correctIndex: 1,
                        explanation: '抵抗は電子の衝突により電流を妨げ、ジュール熱を発生させます。(Slide 14)'
                    },
                    {
                        category: '物質の分類',
                        text: '「シリコン(Si)」や「ゲルマニウム(Ge)」は、導体・絶縁体のどちらに分類される？',
                        options: ['導体 (Conductor)', '絶縁体 (Insulator)', '半導体 (Semiconductor)', '超伝導体 (Superconductor)'],
                        correctIndex: 2,
                        explanation: '条件によって導体や絶縁体のような性質を示す物質を「半導体」と呼びます。ICチップの材料です。(Slide 15)'
                    },
                    {
                        category: 'オームの法則',
                        text: '20Vの電圧をかけたとき、0.5Aの電流が流れた。この回路の抵抗は何Ωか？',
                        options: ['10 Ω', '20 Ω', '40 Ω', '100 Ω'],
                        correctIndex: 2,
                        explanation: 'オームの法則 R = V / I より、20 ÷ 0.5 = 40[Ω] となります。(Slide 16)'
                    }
                ]
            },
            {
                id: 'set3',
                title: '第3回：回路計算の基礎',
                subtitle: '直列・並列・合成抵抗',
                difficulty: '★★☆',
                questions: [
                    {
                        category: '直列回路',
                        text: '抵抗R1とR2を直列に接続したときの合成抵抗Rは？',
                        options: ['R = R1 × R2', 'R = R1 + R2', '1/R = 1/R1 + 1/R2', 'R = (R1+R2)/2'],
                        correctIndex: 1,
                        explanation: '直列回路の合成抵抗は、単純な足し算になります。(Slide 18)'
                    },
                    {
                        category: '直列回路の性質',
                        text: '直列回路において、各抵抗を流れる「電流」の大きさはどうなる？',
                        options: ['抵抗値が大きいほど小さい', '抵抗値が小さいほど小さい', '回路のどこでも等しい', '電源に近いほど大きい'],
                        correctIndex: 2,
                        explanation: '直列回路では、電流の逃げ道がないため、どこでも電流の値は一定です。(Slide 18)'
                    },
                    {
                        category: '並列回路',
                        text: '抵抗R1とR2を並列に接続したときの合成抵抗Rの公式は？',
                        options: ['R = R1 + R2', 'R = R1 × R2', '1/R = 1/R1 + 1/R2', 'R = R1 - R2'],
                        correctIndex: 2,
                        explanation: '並列回路では、各抵抗の逆数の和が、合成抵抗の逆数になります。(Slide 19)'
                    },
                    {
                        category: '合成抵抗計算',
                        text: '10Ωの抵抗を3つ「並列」につないだ時の合成抵抗は？',
                        options: ['3.33... Ω', '10 Ω', '30 Ω', '0.3 Ω'],
                        correctIndex: 0,
                        explanation: '同じ抵抗Rをn個並列につなぐと、合成抵抗は R/n になります。10÷3 ≒ 3.33Ω です。(Slide 19)'
                    },
                    {
                        category: '並列回路の性質',
                        text: '並列回路において、各抵抗にかかる「電圧」はどうなる？',
                        options: ['全ての抵抗で等しい', '抵抗値に比例して大きくなる', '抵抗値に反比例して小さくなる', '電流値によって変化する'],
                        correctIndex: 0,
                        explanation: '並列回路では、分岐したそれぞれの枝にかかる電圧は全て電源電圧と同じになります。(Slide 19)'
                    }
                ]
            },
            {
                id: 'set4',
                title: '第4回：応用計算テクニック',
                subtitle: '分圧・分流・複雑な回路',
                difficulty: '★★★',
                questions: [
                    {
                        category: '分圧の法則',
                        text: '直列回路で、抵抗値の比に応じて電圧が分配される法則を何という？',
                        options: ['オームの法則', 'キルヒホッフの法則', '分圧の法則', 'ジュールの法則'],
                        correctIndex: 2,
                        explanation: '抵抗の大きさに比例して電圧が配分されることを分圧の法則と呼びます。(Slide 20)'
                    },
                    {
                        category: '分圧計算',
                        text: '10Ωと40Ωの抵抗を直列につなぎ、100Vの電圧をかけた。40Ωの抵抗にかかる電圧は？',
                        options: ['20V', '40V', '60V', '80V'],
                        correctIndex: 3,
                        explanation: '分圧の式 V2 = V × (R2 / (R1+R2)) より、100 × (40 / 50) = 80V です。(Slide 20)'
                    },
                    {
                        category: '分流の法則',
                        text: '並列回路において、抵抗値が「小さい」方に流れる電流はどうなる？',
                        options: ['より多く流れる', 'より少なく流れる', '抵抗値に関わらず同じ', '流れない'],
                        correctIndex: 0,
                        explanation: '電流は抵抗が小さい（流れやすい）方へより多く流れます。抵抗値と電流は反比例します。(Slide 20)'
                    },
                    {
                        category: '複雑な計算',
                        text: '「6Ωの抵抗2つを並列」にした塊と、「2Ωの抵抗」を直列につないだ。全体の合成抵抗は？',
                        options: ['4 Ω', '5 Ω', '8 Ω', '14 Ω'],
                        correctIndex: 1,
                        explanation: 'まず並列部分：6Ωが2つで半分の3Ω。次に直列部分：3Ω + 2Ω = 5Ω となります。(Slide 22類似)'
                    },
                    {
                        category: '単位変換',
                        text: '計算結果が「0.02A」となった。これをmA（ミリアンペア）で表すと？',
                        options: ['0.2 mA', '2 mA', '20 mA', '200 mA'],
                        correctIndex: 2,
                        explanation: '1A = 1000mA なので、0.02 × 1000 = 20mA です。LEDの電流値などでよく使われます。(Slide 16)'
                    }
                ]
            },
            {
                id: 'set5',
                title: '第5回：電子部品と実習',
                subtitle: '部品特性・ブレッドボード・実体配線',
                difficulty: '★★☆',
                questions: [
                    {
                        category: 'ブレッドボード',
                        text: 'ブレッドボードの中央部分の穴は、通常どのようにつながっている？',
                        options: ['横一列（電源ラインと同じ向き）につながっている', '縦5つの穴（a-e, f-j）がつながっている', 'すべての穴がつながっている', 'どこもつながっていない'],
                        correctIndex: 1,
                        explanation: '部品を挿すエリアは、縦方向（abcdeの5つ）が内部で導通しています。(Slide 31)'
                    },
                    {
                        category: 'LED',
                        text: 'LED（発光ダイオード）には極性がある。足が長く、電源のプラス側につなぐ端子を何という？',
                        options: ['アノード (Anode)', 'カソード (Cathode)', 'ベース (Base)', 'ゲート (Gate)'],
                        correctIndex: 0,
                        explanation: '足が長い方がアノード(+)、短い方がカソード(-)です。(Slide 30)'
                    },
                    {
                        category: 'センサー',
                        text: '課題で使用する「CdSセル（フォトレジスタ）」の性質は？',
                        options: ['光が当たると抵抗が小さくなる', '光が当たると抵抗が大きくなる', '光が当たると電気を発生する', '温度が上がると光る'],
                        correctIndex: 0,
                        explanation: 'CdSは光の強さに応じて抵抗値が変化するセンサーで、明るいほど抵抗が低くなります。(Slide 30)'
                    },
                    {
                        category: 'トランジスタ',
                        text: 'NPNトランジスタの3つの端子の名前の組み合わせとして正しいものは？',
                        options: ['アノード・カソード・ゲート', 'ベース・コレクタ・エミッタ', '入力・出力・接地', 'プラス・マイナス・グランド'],
                        correctIndex: 1,
                        explanation: 'トランジスタの端子は、ベース(B)、コレクタ(C)、エミッタ(E)の3つです。(Slide 30)'
                    },
                    {
                        category: '配線の作法',
                        text: '回路を作成する際、通常「GND（マイナス、0V）」側の配線には何色を使うのが一般的？',
                        options: ['赤色', '黄色', '黒色（または青）', '白色'],
                        correctIndex: 2,
                        explanation: 'プラス電源は赤、マイナス(GND)は黒や青を使うのが一般的なルールです。(Slide 32)'
                    }
                ]
            }
        ];

        // --- Components ---

        const ProgressBar = ({ current, total }) => (
            <div className="w-full bg-slate-200 rounded-full h-2.5 mb-6 overflow-hidden">
                <div
                className="bg-blue-600 h-2.5 rounded-full transition-all duration-500 ease-out"
                style={{ width: `${(current / total) * 100}%` }}
                ></div>
            </div>
        );

        const ResultCard = ({ isCorrect, explanation, onNext }) => (
            <div className="animate-fade-in-up bg-white p-6 rounded-xl shadow-lg border border-slate-100">
                <div className="flex items-center gap-3 mb-4">
                {isCorrect ? (
                    <CheckCircle className="w-8 h-8 text-green-500" />
                ) : (
                    <XCircle className="w-8 h-8 text-red-500" />
                )}
                <h3 className={`text-xl font-bold ${isCorrect ? 'text-green-700' : 'text-red-700'}`}>
                    {isCorrect ? '正解！' : '不正解...'}
                </h3>
                </div>
                
                <div className="bg-slate-50 p-4 rounded-lg mb-6 text-slate-700 leading-relaxed text-sm">
                <span className="font-bold block mb-1 text-slate-900">解説:</span>
                {explanation}
                </div>

                <button
                onClick={onNext}
                className="w-full py-4 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl shadow-md transition-all active:scale-95 flex items-center justify-center gap-2"
                >
                次へ進む
                <ChevronRight className="w-5 h-5" />
                </button>
            </div>
        );

        // --- Main App Component ---

        function StudyApp() {
            const [view, setView] = useState('menu'); // menu, playing, result
            const [selectedSetId, setSelectedSetId] = useState(null);
            const [currentQIndex, setCurrentQIndex] = useState(0);
            const [selectedOption, setSelectedOption] = useState(null);
            const [isAnswered, setIsAnswered] = useState(false);
            const [score, setScore] = useState(0);
            
            // Stats (Saved in LocalStorage)
            const [stats, setStats] = useState({
                completedSets: [],
                totalScore: 0
            });

            useEffect(() => {
                const saved = localStorage.getItem('elec_math_v2_stats');
                if (saved) setStats(JSON.parse(saved));
            }, []);

            const saveStats = (setId, setScore) => {
                const newStats = { ...stats };
                if (!newStats.completedSets.includes(setId)) {
                    newStats.completedSets.push(setId);
                }
                // Update total score is complex with retries, keeping it simple: count completions
                setStats(newStats);
                localStorage.setItem('elec_math_v2_stats', JSON.stringify(newStats));
            };

            const startExam = (setId) => {
                setSelectedSetId(setId);
                setView('playing');
                setCurrentQIndex(0);
                setScore(0);
                setIsAnswered(false);
                setSelectedOption(null);
            };

            const goHome = () => {
                setView('menu');
                setSelectedSetId(null);
            };

            const handleAnswer = (index) => {
                if (isAnswered) return;
                setSelectedOption(index);
                setIsAnswered(true);
                const currentSet = EXAM_SETS.find(s => s.id === selectedSetId);
                if (index === currentSet.questions[currentQIndex].correctIndex) {
                    setScore(s => s + 1);
                }
            };

            const handleNext = () => {
                const currentSet = EXAM_SETS.find(s => s.id === selectedSetId);
                if (currentQIndex < currentSet.questions.length - 1) {
                    setCurrentQIndex(p => p + 1);
                    setIsAnswered(false);
                    setSelectedOption(null);
                } else {
                    saveStats(selectedSetId, score + (selectedOption === currentSet.questions[currentQIndex].correctIndex ? 1 : 0));
                    setView('result');
                }
            };

            // --- MENU VIEW ---
            if (view === 'menu') {
                return (
                    <div className="min-h-screen pb-10">
                        {/* Hero Header */}
                        <div className="bg-gradient-to-br from-blue-700 to-indigo-800 text-white p-8 pt-12 rounded-b-[2.5rem] shadow-xl mb-6 relative overflow-hidden">
                            <div className="absolute top-0 right-0 p-4 opacity-10">
                                <Zap width={120} height={120} />
                            </div>
                            <div className="relative z-10">
                                <h1 className="text-sm font-bold opacity-80 mb-1">工学院大学 情報学基礎論II</h1>
                                <h2 className="text-3xl font-extrabold mb-4 leading-tight">電気と数学<br/>完全攻略マスター</h2>
                                <div className="flex gap-4 text-sm font-medium">
                                    <div className="bg-white/20 px-3 py-1 rounded-full flex items-center gap-1">
                                        <Award size={16} /> 攻略数: {stats.completedSets.length}/5
                                    </div>
                                    <div className="bg-white/20 px-3 py-1 rounded-full flex items-center gap-1">
                                        <BookOpen size={16} /> 全25問収録
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Exam List */}
                        <div className="px-4 max-w-md mx-auto space-y-4">
                            <h3 className="font-bold text-slate-500 ml-2 mb-2">模擬試験コースを選択</h3>
                            {EXAM_SETS.map((set, idx) => {
                                const isCompleted = stats.completedSets.includes(set.id);
                                return (
                                    <button
                                        key={set.id}
                                        onClick={() => startExam(set.id)}
                                        className="w-full bg-white p-5 rounded-2xl shadow-sm border border-slate-100 hover:shadow-md transition-all active:scale-98 flex items-center justify-between group"
                                    >
                                        <div className="text-left">
                                            <div className="flex items-center gap-2 mb-1">
                                                <span className={`text-xs font-bold px-2 py-0.5 rounded ${isCompleted ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700'}`}>
                                                    {isCompleted ? '完了' : `第${idx+1}回`}
                                                </span>
                                                <span className="text-xs text-slate-400 font-mono tracking-widest">{set.difficulty}</span>
                                            </div>
                                            <h4 className="font-bold text-slate-800 text-lg">{set.title.split('：')[1]}</h4>
                                            <p className="text-xs text-slate-500 mt-1">{set.subtitle}</p>
                                        </div>
                                        <div className={`w-10 h-10 rounded-full flex items-center justify-center ${isCompleted ? 'bg-green-500 text-white' : 'bg-slate-100 text-slate-400 group-hover:bg-blue-600 group-hover:text-white'} transition-colors`}>
                                            {isCompleted ? <CheckCircle size={20} /> : <Zap size={20} />}
                                        </div>
                                    </button>
                                );
                            })}
                        </div>
                        <p className="text-center text-xs text-slate-400 mt-8">全問正解で単位取得を目指そう！</p>
                    </div>
                );
            }

            const currentSet = EXAM_SETS.find(s => s.id === selectedSetId);
            
            // --- RESULT VIEW ---
            if (view === 'result') {
                const percentage = Math.round((score / currentSet.questions.length) * 100);
                return (
                    <div className="min-h-screen bg-slate-50 flex flex-col items-center justify-center p-6">
                        <div className="w-full max-w-md bg-white rounded-3xl shadow-xl p-8 text-center animate-fade-in-up">
                            <div className="mb-6 inline-flex p-4 rounded-full bg-slate-50">
                                {percentage === 100 ? (
                                    <Award className="w-20 h-20 text-yellow-500 animate-pulse-soft" />
                                ) : (
                                    <TrendingUp className="w-20 h-20 text-blue-500" />
                                )}
                            </div>
                            
                            <h2 className="text-2xl font-bold text-slate-800 mb-2">{currentSet.title.split('：')[1]}</h2>
                            <p className="text-slate-500 mb-6 text-sm">結果発表</p>
                            
                            <div className="text-6xl font-black text-slate-900 mb-2 font-mono tracking-tighter">
                                {score}<span className="text-2xl text-slate-400 font-sans font-normal">/{currentSet.questions.length}</span>
                            </div>
                            
                            <p className={`font-bold mb-8 ${percentage === 100 ? 'text-green-600' : 'text-blue-600'}`}>
                                {percentage === 100 ? 'パーフェクト！素晴らしい理解度です。' : 'お疲れ様でした！復習して満点を目指そう。'}
                            </p>

                            <div className="space-y-3">
                                <button
                                    onClick={() => startExam(selectedSetId)}
                                    className="w-full py-4 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl transition-all active:scale-95 shadow-lg shadow-blue-200"
                                >
                                    もう一度挑戦
                                </button>
                                <button
                                    onClick={goHome}
                                    className="w-full py-4 bg-white border-2 border-slate-100 text-slate-600 font-bold rounded-xl transition-all active:scale-95 flex items-center justify-center gap-2 hover:bg-slate-50"
                                >
                                    <Home size={18} />
                                    ホームに戻る
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // --- PLAYING VIEW ---
            const question = currentSet.questions[currentQIndex];

            return (
                <div className="min-h-screen bg-slate-100 md:py-8 font-sans text-slate-800">
                    <div className="max-w-md mx-auto h-full flex flex-col md:h-auto">
                        
                        {/* Header Bar */}
                        <div className="bg-white p-4 flex items-center justify-between shadow-sm md:rounded-t-2xl z-10">
                            <button onClick={goHome} className="p-2 -ml-2 text-slate-400 hover:text-slate-600">
                                <Home size={20} />
                            </button>
                            <span className="font-bold text-slate-700 text-sm">{currentSet.title.split('：')[1]}</span>
                            <div className="text-xs font-bold bg-slate-100 px-2 py-1 rounded text-slate-500">
                                Q{currentQIndex + 1}/{currentSet.questions.length}
                            </div>
                        </div>

                        {/* Progress */}
                        <div className="h-1 w-full bg-slate-200">
                            <div className="h-full bg-blue-500 transition-all duration-300" style={{ width: `${((currentQIndex) / currentSet.questions.length) * 100}%` }}></div>
                        </div>

                        <div className="p-4 flex-1 flex flex-col">
                            {/* Question Card */}
                            <div className="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 mb-6">
                                <span className="inline-block text-xs font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded mb-3">
                                    {question.category}
                                </span>
                                <h2 className="text-lg font-bold leading-relaxed text-slate-900">
                                    {question.text}
                                </h2>
                            </div>

                            {/* Options */}
                            <div className="flex-1">
                                {!isAnswered ? (
                                    <div className="space-y-3">
                                        {question.options.map((option, index) => (
                                            <button
                                                key={index}
                                                onClick={() => handleAnswer(index)}
                                                className="w-full text-left p-4 rounded-xl bg-white border-2 border-slate-200 hover:border-blue-400 hover:bg-blue-50 transition-all active:scale-98 shadow-sm font-medium text-slate-700 flex gap-3 items-start group"
                                            >
                                                <div className="flex-shrink-0 w-6 h-6 rounded-full border-2 border-slate-300 group-hover:border-blue-400 flex items-center justify-center text-xs font-bold text-slate-400 group-hover:text-blue-500 mt-0.5">
                                                    {['A', 'B', 'C', 'D'][index]}
                                                </div>
                                                <span className="leading-tight">{option}</span>
                                            </button>
                                        ))}
                                    </div>
                                ) : (
                                    <div className="space-y-4 animate-fade-in-up">
                                        {/* Result Visualization */}
                                        <div className="space-y-2 opacity-70 pointer-events-none">
                                            {question.options.map((option, index) => {
                                                let styles = "bg-white border-slate-200 text-slate-400";
                                                if (index === question.correctIndex) styles = "bg-green-50 border-green-500 text-green-900 font-bold";
                                                else if (index === selectedOption) styles = "bg-red-50 border-red-500 text-red-900";
                                                
                                                return (
                                                    <div key={index} className={`w-full text-left p-3 rounded-lg border ${styles} text-sm flex gap-3`}>
                                                        {index === question.correctIndex && <CheckCircle size={16} className="mt-0.5" />}
                                                        {index !== question.correctIndex && index === selectedOption && <XCircle size={16} className="mt-0.5" />}
                                                        {index !== question.correctIndex && index !== selectedOption && <div className="w-4" />}
                                                        {option}
                                                    </div>
                                                )
                                            })}
                                        </div>

                                        <ResultCard 
                                            isCorrect={selectedOption === question.correctIndex} 
                                            explanation={question.explanation} 
                                            onNext={handleNext}
                                        />
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<StudyApp />);
    </script>
</body>
</html>
