<!DOCTYPE html>
<html lang="ja" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>TOEIC 700</title>

    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üèÜ</text></svg>">
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: { 850: '#151e32' }
                    },
                    animation: {
                        'bounce-short': 'bounce 0.5s ease-in-out 1',
                        'shake': 'shake 0.4s cubic-bezier(.36,.07,.19,.97) both',
                        'fade-in': 'fadeIn 0.4s ease-out',
                        'slide-up': 'slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1)',
                        'slide-in-right': 'slideInRight 0.4s cubic-bezier(0.16, 1, 0.3, 1)',
                        'pop': 'pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
                        'progress': 'progress 1s ease-out forwards',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        shake: {
                            '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
                            '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                            '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' },
                            '40%, 60%': { transform: 'translate3d(4px, 0, 0)' }
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        },
                        slideInRight: {
                            '0%': { transform: 'translateX(20px)', opacity: '0' },
                            '100%': { transform: 'translateX(0)', opacity: '1' }
                        },
                        pop: {
                            '0%': { transform: 'scale(0.9)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' }
                        },
                        progress: {
                            '0%': { width: '0%' },
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none;
            touch-action: manipulation;
        }
        
        .no-select {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        .selectable-text {
            -webkit-user-select: text;
            user-select: text;
            cursor: text;
        }
        
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 2px; }

        .glass-panel {
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
        }

        .gold-text {
            background: linear-gradient(135deg, #fbbf24 0%, #d97706 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0px 2px 4px rgba(217, 119, 6, 0.1);
        }

        .btn-press { transition: transform 0.1s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.1s, box-shadow 0.1s; }
        .btn-press:active { transform: scale(0.96); opacity: 0.9; }

        .theme-transition {
            transition: background-color 0.4s ease, color 0.4s ease, border-color 0.4s ease;
        }

        /* Circle Progress for Result */
        .circular-chart {
            display: block;
            margin: 0 auto;
            max-width: 80%;
            max-height: 250px;
        }
        .circle-bg {
            fill: none;
            stroke: #eee;
            stroke-width: 3.8;
        }
        .dark .circle-bg {
            stroke: #334155;
        }
        .circle {
            fill: none;
            stroke-width: 2.8;
            stroke-linecap: round;
            animation: progress 1.5s ease-out forwards;
        }
        .percentage {
            fill: #666;
            font-family: sans-serif;
            font-weight: bold;
            font-size: 0.5em;
            text-anchor: middle;
        }
        .dark .percentage { fill: #fff; }

    </style>
</head>
<body class="bg-gray-100 dark:bg-slate-900 text-slate-800 dark:text-slate-100 theme-transition h-screen w-screen overflow-hidden">
    <div id="root" class="h-full w-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef, createContext, useContext } = React;

        // ==========================================
        // AUDIO SYSTEM
        // ==========================================
        const SoundContext = createContext();
        const SoundProvider = ({ children, enabled }) => {
            const audioCtxRef = useRef(null);
            const playTone = (freq, type, duration, vol = 0.1) => {
                if (!enabled) return;
                try {
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    if (!audioCtxRef.current) audioCtxRef.current = new AudioContext();
                    const ctx = audioCtxRef.current;
                    if (ctx.state === 'suspended') ctx.resume();
                    
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.type = type;
                    osc.frequency.setValueAtTime(freq, ctx.currentTime);
                    gain.gain.setValueAtTime(vol, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + duration);
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    osc.start();
                    osc.stop(ctx.currentTime + duration);
                } catch(e) { console.error(e); }
            };

            const playSFX = (type) => {
                if (!enabled) return;
                if (navigator.vibrate) {
                    if (type === 'wrong') navigator.vibrate(200);
                    if (type === 'correct') navigator.vibrate(50);
                    if (type === 'click') navigator.vibrate(10);
                }
                switch (type) {
                    case 'correct':
                        // „Éî„É≥„Éù„É≥ÔºÅ (Ê≠£Ëß£Èü≥: Êòé„Çã„ÅÑ„Çµ„Ç§„É≥Ê≥¢)
                        playTone(880, 'sine', 0.1, 0.3);
                        setTimeout(() => playTone(1760, 'sine', 0.3, 0.3), 100);
                        break;
                    case 'wrong':
                        // „Éñ„Éñ„Éº... (‰∏çÊ≠£Ëß£Èü≥: ‰Ωé„ÅÑ„Éé„Ç≥„ÇÆ„É™Ê≥¢)
                        playTone(150, 'sawtooth', 0.2, 0.4);
                        setTimeout(() => playTone(120, 'sawtooth', 0.3, 0.4), 150);
                        break;
                    case 'click':
                        // „Ç´„ÉÅ„ÉÉ („ÇØ„É™„ÉÉ„ÇØÈü≥: Áü≠„ÅÑÈ´ò„ÅÑÈü≥)
                        playTone(1200, 'triangle', 0.05, 0.1);
                        break;
                    case 'complete':
                        // „Éï„Ç°„É≥„Éï„Ç°„Éº„É¨ (ÂÆå‰∫ÜÈü≥)
                        const now = 0;
                        playTone(523.25, 'sine', 0.2, 0.3); // Do
                        setTimeout(() => playTone(659.25, 'sine', 0.2, 0.3), 150); // Mi
                        setTimeout(() => playTone(783.99, 'sine', 0.2, 0.3), 300); // So
                        setTimeout(() => playTone(1046.50, 'sine', 0.6, 0.4), 450); // High Do
                        break;
                    default: break;
                }
            };
            return <SoundContext.Provider value={playSFX}>{children}</SoundContext.Provider>;
        };

        // ==========================================
        // DATA
        // ==========================================
        // (Simplified data set for brevity, same structure as before)
        const VOCAB_DATA = [
            { id: 'v1', level: 600, word: "significant", meaning: "„Åã„Å™„Çä„ÅÆ„ÄÅÈáçË¶Å„Å™", type: "vocab", choices: ["‰∏ÄÊôÇÁöÑ„Å™", "ÂæÆÁ¥∞„Å™", "Áñë„Çè„Åó„ÅÑ"] },
            { id: 'v2', level: 600, word: "appointment", meaning: "Á¥ÑÊùü„ÄÅ‰∫àÁ¥Ñ„ÄÅ‰ªªÂëΩ", type: "vocab", choices: ["Â§±Êúõ", "Ë®±ÂèØ", "Ë©ï‰æ°"] },
            { id: 'v3', level: 730, word: "tentative", meaning: "‰ªÆ„ÅÆ„ÄÅÊö´ÂÆöÁöÑ„Å™", type: "vocab", choices: ["Êñ≠ÂÆöÁöÑ„Å™", "Ê∞∏‰πÖ„ÅÆ", "È´ò‰æ°„Å™"] },
            { id: 'v4', level: 730, word: "comply", meaning: "ÔºàË¶èÂâá„Å™„Å©„Å´ÔºâÂæì„ÅÜ", type: "vocab", choices: ["‰∏çÊ∫Ä„ÇíË®Ä„ÅÜ", "ÂÆå‰∫Ü„Åô„Çã", "ÊØîËºÉ„Åô„Çã"] },
            { id: 'v5', level: 860, word: "imminent", meaning: "Â∑Æ„ÅóËø´„Å£„Åü", type: "vocab", choices: ["ÁÑ°Èñ¢‰øÇ„Å™", "Â∑®Â§ß„Å™", "‰∏çÂ§â„ÅÆ"] },
            { id: 'v6', level: 860, word: "lucrative", meaning: "ÂÑ≤„Åã„Çã„ÄÅÂà©Áõä„ÅÆ‰∏ä„Åå„Çã", type: "vocab", choices: ["‰∏çÈÅã„Å™", "ÂâµÈÄ†ÁöÑ„Å™", "Á∑©„ÇÑ„Åã„Å™"] },
            { id: 'v7', level: 600, word: "inventory", meaning: "Âú®Â∫´„ÄÅÊ£öÂç∏„Åó", type: "vocab", choices: ["ÊäïË≥á", "ÊãõÂæÖÁä∂", "Áô∫Êòé"] },
            { id: 'v8', level: 730, word: "reimburse", meaning: "Êâï„ÅÑÊàª„Åô", type: "vocab", choices: ["ÂÜçÂà©Áî®„Åô„Çã", "Âº∑Âåñ„Åô„Çã", "Ëº∏ÂÖ•„Åô„Çã"] },
            { id: 'v9', level: 600, word: "proposal", meaning: "ÊèêÊ°à", type: "vocab", choices: ["Âá¶ÂàÜ", "ÁõÆÁöÑ", "ÂèçÂØæ"] },
            { id: 'v10', level: 730, word: "itinerary", meaning: "ÊóÖÁ®ãË°®", type: "vocab", choices: ["Êó•Ë®ò", "ÂÖ•„ÇäÂè£", "Ë¶ÅÁ¥Ñ"] },
            { id: 'v11', level: 860, word: "consecutive", meaning: "ÈÄ£Á∂ö„Åó„Åü", type: "vocab", choices: ["Âª∫Ë®≠ÁöÑ„Å™", "‰øùÂÆàÁöÑ„Å™", "ÁµêÊûúÁöÑ„Å™"] },
            { id: 'v12', level: 900, word: "scrutinize", meaning: "Á∂øÂØÜ„Å´Ë™ø„Åπ„Çã", type: "vocab", choices: ["Ë¶ÅÁ¥Ñ„Åô„Çã", "Êã°Â§ß„Åô„Çã", "ÈÖçÂ∏É„Åô„Çã"] },
            // === Level 600 (Âü∫Á§é„ÉªÂøÖÈ†à) ===
  { level: 600, word: "notify", meaning: "Áü•„Çâ„Åõ„Çã„ÄÅÈÄöÁü•„Åô„Çã", choices: ["Èö†„Åô", "Âê¶ÂÆö„Åô„Çã", "Ê∞ó‰ªò„Åè"] },
  { level: 600, word: "refund", meaning: "Êâï„ÅÑÊàª„Åó„ÄÅËøîÈáë", choices: ["Ë≥áÈáë", "ÂúüÂè∞", "Áô∫Ë¶ã"] },
  { level: 600, word: "contract", meaning: "Â•ëÁ¥Ñ", choices: ["Êé•Ëß¶", "ÂØæÊØî", "Âª∫Ë®≠"] },
  { level: 600, word: "candidate", meaning: "ÂÄôË£úËÄÖ", choices: ["Êó•‰ªò", "„Ç≠„É£„É≥„Éá„Ç£„Éº", "ÁéáÁõ¥„Å™"] },
  { level: 600, word: "shipment", meaning: "Áô∫ÈÄÅ„ÄÅÁ©ç„ÅøËç∑", choices: ["ÂΩ¢", "ÂèãÊÉÖ", "Â∫óÂì°"] },
  { level: 600, word: "conference", meaning: "‰ºöË≠∞", choices: ["Ëá™‰ø°", "ÂèÇÁÖß", "Â•ΩÊÑè"] },
  { level: 600, word: "branch", meaning: "ÊîØÂ∫ó", choices: ["ÊòºÈ£ü", "„Éñ„É©„É≥„Éâ", "„Éñ„É©„Ç∑"] },
  { level: 600, word: "opportunity", meaning: "Ê©ü‰ºö„ÄÅ„ÉÅ„É£„É≥„Çπ", choices: ["ÂèçÂØæ", "Êìç‰Ωú", "ÊÑèË¶ã"] },
  { level: 600, word: "participate", meaning: "ÂèÇÂä†„Åô„Çã", choices: ["‰∫àÊ∏¨„Åô„Çã", "Á∑¥Áøí„Åô„Çã", "ÁâπÂÆö„ÅÆ"] },
  { level: 600, word: "frequently", meaning: "È†ªÁπÅ„Å´", choices: ["Ëá™Áî±„Å´", "ÂÖ¨Âπ≥„Å´", "Êñ∞ÈÆÆ„Å´"] },
  { level: 600, word: "annual", meaning: "ÊØéÂπ¥„ÅÆ„ÄÅÂπ¥1Âõû„ÅÆ", choices: ["ÊâãÂãï„ÅÆ", "ÂãïÁâ©„ÅÆ", "ÁÑ°Âäπ„ÅÆ"] },
  { level: 600, word: "application", meaning: "ÂøúÂãü„ÄÅÁî≥Ë´ã", choices: ["Áß∞Ë≥õ", "„É™„É≥„Ç¥", "ÈÅ©Âøú"] },

  // === Level 730 („Éì„Ç∏„Éç„ÇπÊ®ôÊ∫ñ) ===
  { level: 730, word: "implement", meaning: "ÂÆüË°å„Åô„Çã„ÄÅÂÆüÊñΩ„Åô„Çã", choices: ["Ëº∏ÂÖ•„Åô„Çã", "ÊîπÂñÑ„Åô„Çã", "ÊÑèÂë≥„Åô„Çã"] },
  { level: 730, word: "deadline", meaning: "Á∑†„ÇÅÂàá„Çä", choices: ["Ê≠ªÁ∑ö", "Ë¶ãÂá∫„Åó", "Êï¥Âàó"] },
  { level: 730, word: "budget", meaning: "‰∫àÁÆó", choices: ["„Éê„ÉÉ„Ç∏", "ÊâãËç∑Áâ©", "Â∞èÈÅìÂÖ∑"] },
  { level: 730, word: "negotiation", meaning: "‰∫§Ê∏â", choices: ["Âê¶ÂÆö", "ÁÑ°Ë¶ñ", "„Éä„Éì"] },
  { level: 730, word: "procedure", meaning: "ÊâãÈ†Ü„ÄÅÊâãÁ∂ö„Åç", choices: ["ÁîüÁî£", "ÈÄ≤Ë°å", "‰æ°Ê†º"] },
  { level: 730, word: "substitute", meaning: "‰ª£Áî®ÂìÅ„ÄÅ‰ª£ÁêÜ‰∫∫", choices: ["Â≠óÂπï", "Áâ©Ë≥™", "ÈÉäÂ§ñ"] },
  { level: 730, word: "warranty", meaning: "‰øùË®ºÔºàÊõ∏Ôºâ", choices: ["Ë≠¶Âëä", "Êà¶Â£´", "ÂøÉÈÖç"] },
  { level: 730, word: "postpone", meaning: "Âª∂Êúü„Åô„Çã", choices: ["ÈÉµ‰æø", "ÈÖçÁΩÆ„Åô„Çã", "‰ΩçÁΩÆ„Åô„Çã"] },
  { level: 730, word: "attach", meaning: "Ê∑ª‰ªò„Åô„Çã", choices: ["ÊîªÊíÉ„Åô„Çã", "ÈÅîÊàê„Åô„Çã", "Âºï„Åç‰ªò„Åë„Çã"] },
  { level: 730, word: "subscription", meaning: "ÂÆöÊúüË≥ºË™≠", choices: ["Ë™¨Êòé", "Âá¶ÊñπÁÆã", "Âú∞‰∏ãÈâÑ"] },
  { level: 730, word: "eligible", meaning: "Ë≥áÊ†º„Åå„ÅÇ„Çã", choices: ["Ë™≠„Åø„Å´„Åè„ÅÑ", "ÈÅïÊ≥ï„ÅÆ", "ÈÅ∏„Åπ„Çã"] },
  { level: 730, word: "complimentary", meaning: "ÁÑ°Êñô„ÅÆ„ÄÅÁß∞Ë≥õ„ÅÆ", choices: ["Ë£úË∂≥„ÅÆ", "Áæ©ÂãôÁöÑ„Å™", "ÂÆåÂÖ®„Å™"] },

  // === Level 860+ („Éè„Ç§„Çπ„Ç≥„Ç¢„ÉªÈõ£Èñ¢) ===
  { level: 860, word: "discrepancy", meaning: "‰∏ç‰∏ÄËá¥„ÄÅÈ£ü„ÅÑÈÅï„ÅÑ", choices: ["Ë™¨Êòé", "Ë£ÅÈáè", "Ê∏õÂ∞ë"] },
  { level: 860, word: "mandatory", meaning: "Áæ©ÂãôÁöÑ„Å™„ÄÅÂº∑Âà∂ÁöÑ„Å™", choices: ["‰ªªÊÑè„ÅÆ", "ÊúàÊõú„ÅÆ", "‰∏ªË¶Å„Å™"] },
  { level: 860, word: "preliminary", meaning: "‰∫àÂÇô„ÅÆ„ÄÅÊ∫ñÂÇô„ÅÆ", choices: ["‰∏ªË¶Å„Å™", "‰ª•Ââç„ÅÆ", "ÁßÅÁöÑ„Å™"] },
  { level: 860, word: "exquisite", meaning: "ÈùûÂ∏∏„Å´Áæé„Åó„ÅÑ„ÄÅÁ≤æÂ∑ß„Å™", choices: ["È´ò‰æ°„Å™", "Êéí‰ªñÁöÑ„Å™", "ÊúüÈôêÂàá„Çå„ÅÆ"] },
  { level: 860, word: "alleviate", meaning: "ÔºàËã¶Áóõ„Å™„Å©„ÇíÔºâÂíå„Çâ„Åí„Çã", choices: ["‰∏äÊòá„Åï„Åõ„Çã", "Ââ≤„ÇäÂΩì„Å¶„Çã", "ÂêåÁõü„Åô„Çã"] },
  { level: 860, word: "unprecedented", meaning: "Ââç‰æã„ÅÆ„Å™„ÅÑ", choices: ["‰∫àÊ∏¨„Åß„Åç„Å™„ÅÑ", "‰∏çÂø´„Å™", "Ê∫ñÂÇô‰∏çË∂≥„ÅÆ"] },
  { level: 860, word: "constraint", meaning: "Âà∂Á¥Ñ„ÄÅÂà∂Èôê", choices: ["Âª∫Ë®≠", "Ëã¶ÊÉÖ", "ÂÆöÊï∞"] },
  { level: 860, word: "fluctuation", meaning: "Â§âÂãï", choices: ["ÊµÅÊö¢", "Ê©üËÉΩ", "Âπ≥Èù¢"] },
  { level: 860, word: "incentive", meaning: "ÂãïÊ©ü‰ªò„Åë„ÄÅÂ†±Â•®Èáë", choices: ["ÂâµÂßã", "‰∫ã‰ª∂", "ÂÜÖÈÉ®"] },
  { level: 860, word: "comprehensive", meaning: "ÂåÖÊã¨ÁöÑ„Å™", choices: ["ÁêÜËß£Âäõ„ÅÆ„ÅÇ„Çã", "Á´∂‰∫âÂäõ„ÅÆ„ÅÇ„Çã", "Â¶•ÂçîÁöÑ„Å™"] },

            // --- Level 600: Âü∫Á§é„ÉªÂøÖÈ†à„É¨„Éô„É´ (Êó•Â∏∏Ê•≠Âãô„ÉªÂü∫Á§é) ---
  { level: 600, word: "department", meaning: "ÈÉ®ÁΩ≤„ÄÅÈÉ®ÈñÄ", choices: ["Âá∫Áô∫", "Ê∑±„ÅÑ", "‰æùÂ≠ò"] },
  { level: 600, word: "available", meaning: "Âà©Áî®„Åß„Åç„Çã„ÄÅÁ©∫„ÅÑ„Å¶„ÅÑ„Çã", choices: ["È´ò‰æ°„Å™", "‰æ°ÂÄ§„ÅÆ„ÅÇ„Çã", "ÈÅø„Åë„Çâ„Çå„Å™„ÅÑ"] },
  { level: 600, word: "equipment", meaning: "Ê©üÂô®„ÄÅË£ÖÂÇô", choices: ["ÂÖ¨Âπ≥", "ËÑ±Âá∫", "ÂÆüÈ®ì"] },
  { level: 600, word: "purchase", meaning: "Ë≥ºÂÖ•„Åô„Çã", choices: ["ËøΩÊ±Ç„Åô„Çã", "ÁõÆÁöÑ", "Êäº„Åô"] },
  { level: 600, word: "charge", meaning: "ÊñôÈáë„ÄÅË´ãÊ±Ç„Åô„Çã", choices: ["Â§âÂåñ", "Â•ΩÊ©ü", "ÊÖàÂñÑ"] },
  { level: 600, word: "remain", meaning: "ÔΩû„ÅÆ„Åæ„Åæ„Åß„ÅÇ„Çã„ÄÅÊÆã„Çã", choices: ["ÊÄù„ÅÑÂá∫„Åï„Åõ„Çã", "‰øÆÁêÜ„Åô„Çã", "‰∏ª„Å™"] },
  { level: 600, word: "confirm", meaning: "Á¢∫Ë™ç„Åô„Çã", choices: ["È†ÜÂøú„Åô„Çã", "Áõ¥Èù¢„Åô„Çã", "Ê∑∑‰π±„Åï„Åõ„Çã"] },
  { level: 600, word: "review", meaning: "Ê§úË®é„Åô„Çã„ÄÅË´ñË©ï", choices: ["ÂÜçÂà©Áî®", "Áú∫„ÇÅ", "ÊãíÁµ∂"] },
  { level: 600, word: "benefit", meaning: "Âà©Áõä„ÄÅÊâãÂΩì", choices: ["ÈÅïÂèç", "‰∏ãÊï∑„Åç", "„Éô„É≥„ÉÅ"] },
  { level: 600, word: "additional", meaning: "ËøΩÂä†„ÅÆ", choices: ["‰∏≠ÊØí„ÅÆ", "‰ºùÁµ±ÁöÑ„Å™", "ÂçÅÂàÜ„Å™"] },
  { level: 600, word: "client", meaning: "È°ßÂÆ¢„ÄÅ‰æùÈ†º‰∫∫", choices: ["Â¥ñ", "Ê∞óÂÄô", "Áôª„Çã"] },
  { level: 600, word: "reduce", meaning: "Ê∏õ„Çâ„Åô", choices: ["ÁîüÁî£„Åô„Çã", "Á¥π‰ªã„Åô„Çã", "Ë™òÊÉë„Åô„Çã"] },
  { level: 600, word: "announce", meaning: "Áô∫Ë°®„Åô„Çã", choices: ["Âõ∞„Çâ„Åõ„Çã", "Áô∫Èü≥„Åô„Çã", "ÂàÜÊûê„Åô„Çã"] },
  { level: 600, word: "region", meaning: "Âú∞Âüü", choices: ["ÂÆóÊïô", "ÁêÜÁî±", "Áµ±Ê≤ª"] },
  { level: 600, word: "manager", meaning: "ÈÉ®Èï∑„ÄÅÁÆ°ÁêÜËÄÖ", choices: ["ÊñπÊ≥ï", "‰∏ªË¶Å„Å™", "Ë£ΩÈÄ†Ê•≠ËÄÖ"] },
  { level: 600, word: "factory", meaning: "Â∑•Â†¥", choices: ["Ë¶ÅÁ¥†", "È°î", "ÁúüÂÆü"] },
  { level: 600, word: "directly", meaning: "Áõ¥Êé•„Å´", choices: ["ÊñπÂêë", "Áõ£Áù£", "Ê±ö„Çå"] },
  { level: 600, word: "current", meaning: "ÁèæÂú®„ÅÆ", choices: ["ÈÄöË≤®", "Ê≠£Á¢∫„Å™", "Ê≥¢"] },
  { level: 600, word: "prepare", meaning: "Ê∫ñÂÇô„Åô„Çã", choices: ["ÊØîËºÉ„Åô„Çã", "‰øÆÁêÜ„Åô„Çã", "Â•Ω„ÇÄ"] },
  { level: 600, word: "supply", meaning: "‰æõÁµ¶„Åô„Çã„ÄÅÂøÖÈúÄÂìÅ", choices: ["È©ö„Åç", "ÊîØÊè¥", "Ë£ú„ÅÜ"] },
  { level: 600, word: "invoice", meaning: "Ë´ãÊ±ÇÊõ∏", choices: ["Â£∞", "ÊãõÂæÖ", "ÂÜÖÂÅ¥"] },
  { level: 600, word: "attend", meaning: "Âá∫Â∏≠„Åô„Çã", choices: ["Ê≥®ÊÑè„Åô„Çã", "ÊÑèÂõ≥„Åô„Çã", "ÂÇæÂêë„Åå„ÅÇ„Çã"] },
  { level: 600, word: "delay", meaning: "ÈÅÖ„Çâ„Åõ„Çã", choices: ["ÈÖçÈÅî„Åô„Çã", "È†º„Çã", "Êó•Âàä„ÅÆ"] },
  { level: 600, word: "encourage", meaning: "Êé®Â•®„Åô„Çã„ÄÅÂä±„Åæ„Åô", choices: ["ÂãáÊ∞ó", "ÈÅ≠ÈÅá„Åô„Çã", "Êï∞„Åà„Çã"] },
  { level: 600, word: "result", meaning: "ÁµêÊûú", choices: ["‰æÆËæ±", "Áõ∏Ë´á", "Â°©Ëæõ„ÅÑ"] },
  { level: 600, word: "firm", meaning: "‰ºöÁ§æ„ÄÅ‰∫ãÂãôÊâÄ", choices: ["Ëæ≤Â†¥", "ÂΩ¢", "Â†Ö„ÅÑ"] },
  { level: 600, word: "project", meaning: "Ë®àÁîª„ÄÅ‰∫ãÊ•≠", choices: ["Áâ©‰Ωì", "‰∏ªÈ°å", "ÊãíÁµ∂"] },
  { level: 600, word: "local", meaning: "Âú∞ÂÖÉ„ÅÆ", choices: ["Â£∞„ÅÆ", "‰ΩçÁΩÆ", "Èçµ"] },
  { level: 600, word: "agreement", meaning: "ÂêàÊÑè„ÄÅÂ•ëÁ¥ÑÊõ∏", choices: ["Ëæ≤Ê•≠", "Ë≠∞Ë´ñ", "ËßíÂ∫¶"] },
  { level: 600, word: "traffic", meaning: "‰∫§ÈÄöÔºàÈáèÔºâ", choices: ["Á¥†Êô¥„Çâ„Åó„ÅÑ", "ÊÇ≤ÂäáÁöÑ„Å™", "ËøΩË∑°"] },
  { level: 600, word: "resume", meaning: "Â±•Ê≠¥Êõ∏", choices: ["ÂÜçÈñã„Åô„Çã", "Ë¶ÅÁ¥Ñ", "‰ªÆÂÆö„Åô„Çã"] },
  { level: 600, word: "crowded", meaning: "Ê∑∑Èõë„Åó„Åü", choices: ["Èõ≤", "ÁéãÂÜ†", "Áâõ"] },
  { level: 600, word: "urgent", meaning: "Á∑äÊÄ•„ÅÆ", choices: ["‰ª£ÁêÜ‰∫∫", "ÈäÄ", "ÈÉΩ‰ºö„ÅÆ"] },
  { level: 600, word: "delivery", meaning: "ÈÖçÈÅî", choices: ["ËÇùËáì", "Áô∫Ë¶ã", "ÂØ©Ë≠∞"] },
  { level: 600, word: "staff", meaning: "ËÅ∑Âì°", choices: ["Ë©∞„ÇÅËæº„ÇÄ", "Â†Ö„ÅÑ", "ÊùêÊñô"] },
  { level: 600, word: "feature", meaning: "ÁâπÂæ¥„ÄÅÁâπÈõÜ„Åô„Çã", choices: ["Êú™Êù•", "ÁæΩÊ†π", "ÊÅê„Çå"] },
  { level: 600, word: "mention", meaning: "Ëø∞„Åπ„Çã", choices: ["Á∂≠ÊåÅ„Åô„Çã", "ÊÑèÂë≥„Åô„Çã", "Á≤æÁ•ûÁöÑ„Å™"] },
  { level: 600, word: "inquire", meaning: "Â∞ã„Å≠„Çã„ÄÅÂïè„ÅÑÂêà„Çè„Åõ„Çã", choices: ["ÂøÖË¶Å„Å®„Åô„Çã", "Áç≤Âæó„Åô„Çã", "ÈºìËàû„Åô„Çã"] },
  { level: 600, word: "quarter", meaning: "ÂõõÂçäÊúü", choices: ["ÂºïÁî®", "Èáè", "Èùô„Åã„Å™"] },
  { level: 600, word: "award", meaning: "Ë≥û„ÄÅÊéà‰∏é„Åô„Çã", choices: ["Â†±ÈÖ¨", "ÁóÖÊ£ü", "Êà¶‰∫â"] },
  { level: 600, word: "brochure", meaning: "„Éë„É≥„Éï„É¨„ÉÉ„Éà", choices: ["Êûù", "Â£ä„Çå„Åü", "Ê©ã"] },
  { level: 600, word: "offer", meaning: "Áî≥„ÅóÂá∫„Çã„ÄÅÊèê‰æõ„Åô„Çã", choices: ["‰∏çÂø´„Å´„Åô„Çã", "„Åó„Å∞„Åó„Å∞", "ÂÖ¨„ÅÆ"] },
  { level: 600, word: "highly", meaning: "ÈùûÂ∏∏„Å´", choices: ["È´ò„Åè", "Â†Ö„Åè", "„Åª„Å®„Çì„Å©"] },
  { level: 600, word: "position", meaning: "ËÅ∑„ÄÅ‰ΩçÁΩÆ", choices: ["ÊâÄÊúâ", "ÂèØËÉΩÊÄß", "ÊØí"] },
  { level: 600, word: "opening", meaning: "Á©∫„Åç„ÄÅÈñãÂ∫ó", choices: ["ÊÑèË¶ã", "Êìç‰Ωú", "ÂèçÂØæ"] },
  { level: 600, word: "duty", meaning: "Áæ©Âãô„ÄÅËÅ∑Âãô", choices: ["„Åª„Åì„Çä", "ÊúüÊó•", "ÊúüÈñì"] },
  { level: 600, word: "admit", meaning: "Ë™ç„ÇÅ„Çã„ÄÅÂÖ•Â†¥„ÇíË®±ÂèØ„Åô„Çã", choices: ["Áß∞Ë≥õ„Åô„Çã", "È†ÜÂøú„Åô„Çã", "ÊèêÂá∫„Åô„Çã"] },
  { level: 600, word: "disturb", meaning: "ÈÇ™È≠î„Åô„Çã", choices: ["ÂàÜÈÖç„Åô„Çã", "Âú∞Âå∫", "ÈÅ†„ÅÑ"] },
  { level: 600, word: "vehicle", meaning: "‰πó„ÇäÁâ©", choices: ["Ë®ò‰∫ã", "Á≤íÂ≠ê", "ÈáéËèú"] },
  { level: 600, word: "clothing", meaning: "Ë°£È°û", choices: ["Â∏É", "Èñâ„Åò„Çã", "Èõ≤"] },

  // --- Level 730: „Éì„Ç∏„Éç„ÇπÊ®ôÊ∫ñ (ÂÆüÂãô„Éª‰∏≠Á¥ö) ---
  { level: 730, word: "postpone", meaning: "Âª∂Êúü„Åô„Çã", choices: ["ÈÉµ‰æø", "‰ΩçÁΩÆ„Åô„Çã", "ÂèçÂØæ„Åô„Çã"] },
  { level: 730, word: "estimate", meaning: "Ë¶ãÁ©ç„ÇÇ„Çä", choices: ["Ë®≠Á´ã„Åô„Çã", "‰∏çÂãïÁî£", "Â∞äÊï¨"] },
  { level: 730, word: "launch", meaning: "ÈñãÂßã„Åô„Çã„ÄÅÁô∫Â£≤„Åô„Çã", choices: ["ÊòºÈ£ü", "Á¨ë„ÅÜ", "Ê¥óÊøØ"] },
  { level: 730, word: "recruit", meaning: "Êé°Áî®„Åô„Çã", choices: ["Ë®òÈå≤", "ÂõûÂæ©„Åô„Çã", "Âèó„ÅëÂèñ„Çã"] },
  { level: 730, word: "merger", meaning: "Âêà‰Ωµ", choices: ["‰∏ªË¶Å„Å™", "Á´Ø", "Á∑äÊÄ•"] },
  { level: 730, word: "stable", meaning: "ÂÆâÂÆö„Åó„Åü", choices: ["„ÉÜ„Éº„Éñ„É´", "ÂèØËÉΩ„Å™", "‰∏ªË¶Å„Å™"] },
  { level: 730, word: "agenda", meaning: "Ë≠∞È°å", choices: ["‰ª£ÁêÜÂ∫ó", "ÊÄßÂà•", "ÂÜç„Å≥"] },
  { level: 730, word: "predict", meaning: "‰∫àÊ∏¨„Åô„Çã", choices: ["Èò≤„Åê", "„Åµ„Çä„Çí„Åô„Çã", "Â•Ω„ÇÄ"] },
  { level: 730, word: "revise", meaning: "‰øÆÊ≠£„Åô„Çã", choices: ["ËÄÉÊ°à„Åô„Çã", "Âä©Ë®Ä„Åô„Çã", "Âæ©Ê¥ª„Åô„Çã"] },
  { level: 730, word: "operate", meaning: "Êìç‰Ωú„Åô„Çã„ÄÅÈÅãÂñ∂„Åô„Çã", choices: ["ÂçîÂäõ„Åô„Çã", "Èñã„Åè", "ÂèçÂØæ„Åô„Çã"] },
  { level: 730, word: "expense", meaning: "ÁµåË≤ª„ÄÅË≤ªÁî®", choices: ["Êã°Â§ß", "ÊúüÂæÖ", "ÁµåÈ®ì"] },
  { level: 730, word: "overseas", meaning: "Êµ∑Â§ñ„ÅÆ", choices: ["Áõ£Áù£„Åô„Çã", "ÂÖ®‰ΩìÁöÑ„Å™", "ÂÖãÊúç„Åô„Çã"] },
  { level: 730, word: "remind", meaning: "ÊÄù„ÅÑÂá∫„Åï„Åõ„Çã", choices: ["ÊÆã„Çã", "ÂøÉ", "Áô∫Ë®Ä„Åô„Çã"] },
  { level: 730, word: "organize", meaning: "„Åæ„Å®„ÇÅ„Çã„ÄÅÁµÑÁπî„Åô„Çã", choices: ["Ëµ∑Ê∫ê", "ÊúâÊ©ü„ÅÆ", "ÊôÆÈÄö"] },
  { level: 730, word: "term", meaning: "Êù°‰ª∂„ÄÅÊúüÈñì", choices: ["„ÉÅ„Éº„É†", "È£º„ÅÑ„Å™„Çâ„Åô", "ÊôÇ"] },
  { level: 730, word: "indicate", meaning: "Á§∫„Åô", choices: ["Áî£Ê•≠", "Âê´„ÇÄ", "Ê∏õÂ∞ë„Åô„Çã"] },
  { level: 730, word: "survey", meaning: "Ë™øÊüª", choices: ["Ë°®Èù¢", "Áîü„ÅçÊÆã„Çã", "Á¢∫ÂÆü„Å™"] },
  { level: 730, word: "involve", meaning: "Âê´„ÇÄ„ÄÅÈñ¢‰∏é„Åï„Åõ„Çã", choices: ["ÂõûËª¢„Åô„Çã", "Ëß£Ê±∫„Åô„Çã", "ÈÄ≤Âåñ„Åô„Çã"] },
  { level: 730, word: "process", meaning: "Âá¶ÁêÜ„Åô„Çã„ÄÅÂ∑•Á®ã", choices: ["ÈÄ≤Ë°å", "ÊâÄÊúâ„Åô„Çã", "ÁéãÂ•≥"] },
  { level: 730, word: "seek", meaning: "Ê±Ç„ÇÅ„Çã", choices: ["ÁóÖÊ∞ó„ÅÆ", "Â∫ßÂ∏≠", "Ë¶ã„Åà„Çã"] },
  { level: 730, word: "author", meaning: "ËëóËÄÖ", choices: ["Ê®©Â®Å", "Áßã", "Êú¨Áâ©„ÅÆ"] },
  { level: 730, word: "representative", meaning: "ÊãÖÂΩìËÄÖ„ÄÅ‰ª£Ë°®ËÄÖ", choices: ["„Éó„É¨„Çº„É≥„Éà", "‰øùÂ≠òÁöÑ„Å™", "Áπ∞„ÇäËøî„Åó„ÅÆ"] },
  { level: 730, word: "colleague", meaning: "ÂêåÂÉö", choices: ["Â§ßÂ≠¶", "ÈõÜ„ÇÅ„Çã", "Ë°ùÁ™Å"] },
  { level: 730, word: "detail", meaning: "Ë©≥Á¥∞", choices: ["Â∞èÂ£≤", "„Åó„Å£„ÅΩ", "ÂèñÂºï"] },
  { level: 730, word: "factor", meaning: "Ë¶ÅÂõ†", choices: ["Â∑•Â†¥", "È°î", "‰∫ãÂÆü"] },
  { level: 730, word: "regarding", meaning: "ÔΩû„Å´Èñ¢„Åó„Å¶", choices: ["Èñ¢‰øÇ„Å™„Åè", "Ë¶ã„Å™„Åô", "Êå®Êã∂"] },
  { level: 730, word: "production", meaning: "ÁîüÁî£", choices: ["‰øùË≠∑", "Ë£ΩÂìÅ", "ËÅ∑Ê•≠"] },
  { level: 730, word: "promote", meaning: "ÊòáÈÄ≤„Åï„Åõ„Çã„ÄÅ‰øÉÈÄ≤„Åô„Çã", choices: ["Á¥ÑÊùü„Åô„Çã", "Êèê‰æõ„Åô„Çã", "ÂÆà„Çã"] },
  { level: 730, word: "regularly", meaning: "ÂÆöÊúüÁöÑ„Å´", choices: ["Ë¶èÂâá", "ÁôªÈå≤„Åô„Çã", "Ê≥ïÁöÑ„Å™"] },
  { level: 730, word: "temporary", meaning: "‰∏ÄÊôÇÁöÑ„Å™", choices: ["Ë™òÊÉë", "Ë©¶„Åø", "Ê∞óÊÄß"] },
  { level: 730, word: "architect", meaning: "Âª∫ÁØâÂÆ∂", choices: ["ÊäÄË°ì", "„Ç¢„Éº„Ç´„Ç§„Éñ", "ÂåóÊ•µ"] },
  { level: 730, word: "seminar", meaning: "„Çª„Éü„Éä„Éº", choices: ["‰ºº„Å¶„ÅÑ„Çã", "‰∏äÁ¥ö„ÅÆ", "ËàπÂì°"] },
  { level: 730, word: "invest", meaning: "ÊäïË≥á„Åô„Çã", choices: ["ÊãõÂæÖ„Åô„Çã", "Áô∫Êòé„Åô„Çã", "Ë™øÊüª„Åô„Çã"] },
  { level: 730, word: "approve", meaning: "ÊâøË™ç„Åô„Çã", choices: ["Ë®ºÊòé„Åô„Çã", "ÊîπÂñÑ„Åô„Çã", "Âãï„Åè"] },
  { level: 730, word: "retirement", meaning: "ÈÄÄËÅ∑", choices: ["Áñ≤„Çå„Åü", "ÂÖ®‰ΩìÁöÑ„Å™", "Ë©¶„Åø"] },
  { level: 730, word: "various", meaning: "„Åï„Åæ„Åñ„Åæ„Å™", choices: ["‰æ°ÂÄ§", "ÈùûÂ∏∏„Å´", "Â§âÊï∞"] },
  { level: 730, word: "expansion", meaning: "Êã°Â§ß", choices: ["Ë≤ªÁî®", "ÊúüÂæÖ", "Ë™¨Êòé"] },
  { level: 730, word: "property", meaning: "‰∏çÂãïÁî£„ÄÅË≤°Áî£", choices: ["ÈÅ©Âàá„Å™", "ÊèêÊ°à", "Ë≤ßÂõ∞"] },
  { level: 730, word: "maintain", meaning: "Á∂≠ÊåÅ„Åô„Çã", choices: ["‰∏ª„Å™", "Ë®ÄÂèä„Åô„Çã", "ÁÆ°ÁêÜ„Åô„Çã"] },
  { level: 730, word: "shipment", meaning: "Áô∫ÈÄÅ", choices: ["ÂΩ¢", "Ëàπ", "Â∫ó"] },
  { level: 730, word: "priority", meaning: "ÂÑ™ÂÖàÈ†Ü‰Ωç", choices: ["‰ª•Ââç„ÅÆ", "ÁßÅÁöÑ„Å™", "ÈÅéÂçäÊï∞"] },
  { level: 730, word: "conduct", meaning: "ÂÆüÊñΩ„Åô„Çã„ÄÅË°å„ÅÑ", choices: ["ÈÄ£Áµ°„Åô„Çã", "Âª∫Ë®≠„Åô„Çã", "Âê´„ÇÄ"] },
  { level: 730, word: "check", meaning: "Â∞èÂàáÊâã„ÄÅÁ¢∫Ë™ç„Åô„Çã", choices: ["È†¨", "Ë°ùÊíÉ", "„Å≤„Çà„Åì"] },
  { level: 730, word: "quarterly", meaning: "Âπ¥4Âõû„ÅÆ", choices: ["ÂõõÂàÜ„ÅÆ‰∏Ä", "Èáè", "Èùô„Åã„Å´"] },
  { level: 730, word: "contribute", meaning: "Ë≤¢ÁåÆ„Åô„Çã„ÄÅÂØÑ‰ªò„Åô„Çã", choices: ["ÂàÜÈÖç„Åô„Çã", "Â∏∞„Åô„Çã", "ÊßãÊàê„Åô„Çã"] },
  { level: 730, word: "advertising", meaning: "Â∫ÉÂëä", choices: ["Âø†Âëä", "ÈÄÜ„ÅÆ", "ÈÄ≤Ê≠©"] },
  { level: 730, word: "resident", meaning: "‰ΩèÊ∞ë", choices: ["Â§ßÁµ±È†ò", "ÊäµÊäó„Åô„Çã", "‰Ωè„ÇÄ"] },
  { level: 730, word: "describe", meaning: "Ë™¨Êòé„Åô„Çã„ÄÅÊèèÂÜô„Åô„Çã", choices: ["Ë≥ºË™≠„Åô„Çã", "Âá¶Êñπ„Åô„Çã", "ËÑöÊú¨"] },
  { level: 730, word: "solution", meaning: "Ëß£Ê±∫Á≠ñ", choices: ["Ê±öÊüì", "Âõ∫„ÅÑ", "ÂîØ‰∏Ä„ÅÆ"] },
  { level: 730, word: "secure", meaning: "Á¢∫‰øù„Åô„Çã„ÄÅÂÆâÂÖ®„Å™", choices: ["ÁßòÂØÜ", "Ê≤ª„Åô", "ÊÅê„Çç„Åó„ÅÑ"] },

  // --- Level 860+: „Éè„Ç§„Çπ„Ç≥„Ç¢„ÉªÈõ£Èñ¢ (ÊäΩË±°Â∫¶È´ò„ÉªÂ∞ÇÈñÄÁöÑ) ---
  { level: 860, word: "deficit", meaning: "Ëµ§Â≠ó", choices: ["ÊïóÂåó", "Ê¨†Èô•", "ÂÆöÁæ©"] },
  { level: 860, word: "prohibit", meaning: "Á¶ÅÊ≠¢„Åô„Çã", choices: ["Â±ïÁ§∫„Åô„Çã", "ÁîüÊÅØ„Åô„Çã", "ÁøíÊÖ£"] },
  { level: 860, word: "verify", meaning: "Ê§úË®º„Åô„Çã„ÄÅÁ¢∫„Åã„ÇÅ„Çã", choices: ["Â§âÂåñ„Åô„Çã", "ÈùûÂ∏∏„Å´", "Â§öÊßò„Å™"] },
  { level: 860, word: "adjacent", meaning: "Èö£Êé•„Åó„Åü", choices: ["Ë™øÊï¥„Åô„Çã", "ÂΩ¢ÂÆπË©û", "ÂçÅÂàÜ„Å™"] },
  { level: 860, word: "consensus", meaning: "ÂêàÊÑè", choices: ["‰∫∫Âè£Ë™øÊüª", "ÁµêÊûú", "ÊÑèË≠ò"] },
  { level: 860, word: "deduct", meaning: "Â∑Æ„ÅóÂºï„Åè", choices: ["Êé®Ê∏¨„Åô„Çã", "ÂÆüË°å„Åô„Çã", "Ë™òÂ∞é„Åô„Çã"] },
  { level: 860, word: "amenity", meaning: "Âø´ÈÅ©„Å™Ë®≠ÂÇô", choices: ["‰øÆÊ≠£„Åô„Çã", "Èáè", "Êïµ"] },
  { level: 860, word: "pertain", meaning: "Èñ¢‰øÇ„Åå„ÅÇ„Çã", choices: ["Âê´„ÇÄ", "Á∂≠ÊåÅ„Åô„Çã", "ÈÅîÊàê„Åô„Çã"] },
  { level: 860, word: "unanimous", meaning: "Ê∫ÄÂ†¥‰∏ÄËá¥„ÅÆ", choices: ["ÂåøÂêç„ÅÆ", "ÈáéÂøÉÁöÑ„Å™", "Â∑®Â§ß„Å™"] },
  { level: 860, word: "speculate", meaning: "Êé®Ê∏¨„Åô„Çã", choices: ["ÂÖâÊôØ", "ÁâπÂÆö„ÅÆ", "Ë¶ãÁâ©‰∫∫"] },
  { level: 860, word: "commence", meaning: "ÈñãÂßã„Åô„Çã", choices: ["„Ç≥„É°„É≥„Éà", "ÂïÜÊ•≠", "Áß∞Ë≥õ„Åô„Çã"] },
  { level: 860, word: "appraisal", meaning: "ÊüªÂÆö„ÄÅË©ï‰æ°", choices: ["Ë≥ûË≥õ", "Ë©ï‰æ°„Åô„Çã", "È©ö„Åè"] },
  { level: 860, word: "fluctuate", meaning: "Â§âÂãï„Åô„Çã", choices: ["ÊµÅÊö¢„Å™", "Âπ≥„Çâ„Å™", "È£õ„Å≥Á´ã„Å§"] },
  { level: 860, word: "subsidiary", meaning: "Â≠ê‰ºöÁ§æ", choices: ["Ë£úÂä©Èáë", "ÂÆüË≥™ÁöÑ„Å™", "‰ª£„Çè„Çä„ÅÆ"] },
  { level: 860, word: "directory", meaning: "ÂêçÁ∞ø„ÄÅ‰ΩèÊâÄÈå≤", choices: ["ÊñπÂêë", "Áõ¥Êé•", "Áõ£Áù£"] },
  { level: 860, word: "duration", meaning: "Á∂ôÁ∂öÊúüÈñì", choices: ["ËÄê‰πÖÊÄß", "Áæ©Âãô", "ÈÄÄÂ±à„Å™"] },
  { level: 860, word: "certificate", meaning: "Ë®ºÊòéÊõ∏", choices: ["Á¢∫ÂÆü„Å™", "Ë®ºÊòé„Åô„Çã", "Ëä∏Ë°ìÁöÑ„Å™"] },
  { level: 860, word: "mandatory", meaning: "Áæ©ÂãôÁöÑ„Å™", choices: ["‰ªªÊÑè„ÅÆ", "ÊúàÊõúÊó•„ÅÆ", "‰∏ªË¶Å„Å™"] },
  { level: 860, word: "outlook", meaning: "Ë¶ãÈÄö„Åó", choices: ["Â§ñË¶ã", "Âá∫Âäõ", "ÁµêÊûú"] },
  { level: 860, word: "periodically", meaning: "ÂÆöÊúüÁöÑ„Å´", choices: ["ÊúüÈñì", "Êñ∞ËÅû", "Âë®Ëæ∫„ÅÆ"] },
  { level: 860, word: "supervise", meaning: "Áõ£Áù£„Åô„Çã", choices: ["ÂÑ™„Çå„Åü", "Áîü„ÅçÊÆã„Çã", "‰øÆÊ≠£„Åô„Çã"] },
  { level: 860, word: "transaction", meaning: "ÂèñÂºï", choices: ["Ëº∏ÈÄÅ", "ÁøªË®≥", "Â§âÂåñ"] },
  { level: 860, word: "yield", meaning: "Áîü„ÇÄ„ÄÅÂà©Âõû„Çä", choices: ["Âè´„Å∂", "Áïë", "Áõæ"] },
  { level: 860, word: "clarify", meaning: "ÊòéÁ¢∫„Å´„Åô„Çã", choices: ["ÂàÜÈ°û„Åô„Çã", "„Åç„Çå„ÅÑ„Å´„Åô„Çã", "ÊãçÊâã„Åô„Çã"] },
  { level: 860, word: "preside", meaning: "Âè∏‰ºö„Çí„Åô„Çã„ÄÅ‰∏ªÂÆ∞„Åô„Çã", choices: ["‰Ωè„ÇÄ", "Ê≠£Á¢∫„Å™", "Ââç„Å∏"] },
  { level: 860, word: "questionnaire", meaning: "„Ç¢„É≥„Ç±„Éº„Éà", choices: ["Ë≥™Âïè", "Êé¢Ê±Ç", "Âàó"] },
  { level: 860, word: "interruption", meaning: "‰∏≠Êñ≠", choices: ["ÈÄöË®≥", "‰∫§Â∑ÆÁÇπ", "Â∞éÂÖ•"] },
  { level: 860, word: "nominate", meaning: "Êé®Ëñ¶„Åô„Çã", choices: ["ÊîØÈÖç„Åô„Çã", "ÂêçÂâç", "Êï∞"] },
  { level: 860, word: "pharmacist", meaning: "Ëñ¨Ââ§Â∏´", choices: ["Ëæ≤Â†¥", "ÂÆ≥", "È≠ÖÂäõ"] },
  { level: 860, word: "adequate", meaning: "ÂçÅÂàÜ„Å™", choices: ["ÈÅ©Âàá„Å™", "Âä†„Åà„Çã", "Â§ß‰∫∫"] },
  { level: 860, word: "capability", meaning: "ËÉΩÂäõ", choices: ["ÂÆπÈáè", "È¶ñÈÉΩ", "Â∏ΩÂ≠ê"] },
  { level: 860, word: "coordinate", meaning: "Ë™øÊï¥„Åô„Çã", choices: ["ÂçîÂäõ„Åô„Çã", "ÂæìÂ±û„Åô„Çã", "Ê≥®Êñá„Åô„Çã"] },
  { level: 860, word: "discretion", meaning: "Ë£ÅÈáè", choices: ["Ë™¨Êòé", "ÂàÜÈõ¢", "‰∏ç‰∏ÄËá¥"] },
  { level: 860, word: "endorse", meaning: "ÊîØÊåÅ„Åô„Çã„ÄÅÂÆ£‰ºù„Åô„Çã", choices: ["ËÄê„Åà„Çã", "Âº∑Âà∂„Åô„Çã", "Â±ãÂÜÖ"] },
  { level: 860, word: "extract", meaning: "ÊäúÁ≤ã", choices: ["Ê≠£Á¢∫„Å™", "Â•ëÁ¥Ñ", "‰ΩôÂàÜ„Å™"] },
  { level: 860, word: "garment", meaning: "Ë°£ÊñôÂìÅ", choices: ["Â∫≠", "Ë≠¶ÂÇôÂì°", "„Ç¥„Éü"] },
  { level: 860, word: "incur", meaning: "ÔºàË≤†ÂÇµ„Å™„Å©„ÇíÔºâË¢´„Çã", choices: ["Áô∫Áîü„Åô„Çã", "Ê≤ªÁôÇ„Åô„Çã", "Âê´„ÇÄ"] },
  { level: 860, word: "landmark", meaning: "ÂêçÊâÄ", choices: ["È¢®ÊôØ", "Âú∞‰∏ª", "ÁùÄÈô∏"] },
  { level: 860, word: "lease", meaning: "Ë≥ÉË≤∏ÂÄüÂ•ëÁ¥Ñ", choices: ["„Çà„ÇäÂ∞ë„Å™„ÅÑ", "Ëß£Êîæ„Åô„Çã", "Âéª„Çã"] },
  { level: 860, word: "moderate", meaning: "ÈÅ©Â∫¶„Å™", choices: ["Áèæ‰ª£„ÅÆ", "‰øÆÊ≠£„Åô„Çã", "„É¢„Éá„É´"] },
  { level: 860, word: "patent", meaning: "ÁâπË®±", choices: ["Ë¶™", "ÂøçËÄêÂº∑„ÅÑ", "„Éë„Çø„Éº„É≥"] },
  { level: 860, word: "predecessor", meaning: "Ââç‰ªªËÄÖ", choices: ["Ââç‰æã", "‰∫àÊ∏¨„Åô„Çã", "Ê≥®Êñá„Åô„Çã"] },
  { level: 860, word: "remittance", meaning: "ÈÄÅÈáë", choices: ["Ë®±ÂèØ", "ÊÆã„Çä", "Âà∂Èôê"] },
  { level: 860, word: "statistics", meaning: "Áµ±Ë®à", choices: ["Â∑û", "ÂÉè", "Âú∞‰Ωç"] },
  { level: 860, word: "tenant", meaning: "ÂÄüÂÆ∂‰∫∫„ÄÅ„ÉÜ„Éä„É≥„Éà", choices: ["ÂÇæÂêë„Åå„ÅÇ„Çã", "„ÉÜ„É≥„Éà", "ÂçÅ"] },
  { level: 860, word: "valid", meaning: "ÊúâÂäπ„Å™", choices: ["‰æ°ÂÄ§", "ÁÑ°Âäπ„Å™", "Ë∞∑"] },
  { level: 860, word: "workforce", meaning: "ÂæìÊ•≠Âì°Êï∞", choices: ["‰ΩúÊ•≠Â†¥", "Âäõ", "‰ªï‰∫ã"] },
  { level: 860, word: "acknowledge", meaning: "Âèó„ÅëÂèñ„Å£„Åü„Åì„Å®„ÇíÁü•„Çâ„Åõ„Çã", choices: ["Áü•„Çã", "Áü•Ë≠ò", "‰ªä"] },
  { level: 860, word: "correspondence", meaning: "ÈÄö‰ø°„ÄÅÊâãÁ¥ô", choices: ["‰∏ÄËá¥", "ÁâπÊ¥æÂì°", "ÂøúÁ≠î"] },
  { level: 860, word: "exclusive", meaning: "Áã¨Âç†ÁöÑ„Å™", choices: ["ÂåÖÊã¨ÁöÑ„Å™", "È´ò‰æ°„Å™", "ÈÅéÂ∫¶„ÅÆ"] },
      
        ];

        // ==========================================
// NEW TOEIC DATA (FROM PDF)
// ==========================================

// „É™„Çπ„Éã„É≥„Ç∞„Çª„ÇØ„Ç∑„Éß„É≥ (Part 1 - 4)
const LISTENING_QUESTION_DATA = [
    // --- Part 1: Photographs ---
    {
        id: 'p1-1', part: 1, type: 'listening', contextType: 'image',
        // „ÉÄ„Éü„ÉºÁîªÂÉèURL (ÂÆüÈöõ„ÅÆÂÆüË£Ö„Åß„ÅØÈÅ©Âàá„Å™ÁîªÂÉè„ÇíÈÖçÁΩÆ)
        imageUrl: "https://placehold.co/600x400/3b82f6/white?text=Man+at+Computer",
        script: "(A) The man's walking around the room. (B) The man's examining the jacket. (C) The man's looking at the map. (D) The man's sitting in front of a computer.",
        question: "ÂÜôÁúü„ÅÆÊèèÂÜô„Å®„Åó„Å¶ÊúÄ„ÇÇÈÅ©Âàá„Å™„ÇÇ„ÅÆ„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ„ÄÇ",
        options: ["(A)", "(B)", "(C)", "(D)"],
        correct: 3,
        explanation: "Áî∑ÊÄß„Åå„Ç≥„É≥„Éî„É•„Éº„Çø„ÅÆÂâç„Å´Â∫ß„Å£„Å¶‰ΩúÊ•≠„Çí„Åó„Å¶„ÅÑ„ÇãÊßòÂ≠ê„ÇíÊèèÂÜô„Åó„Å¶„ÅÑ„Çã(D)„ÅåÊ≠£Ëß£„ÄÇ(A)walking„ÅØworking„Å®„ÅÆÈü≥„ÅÆ„Å≤„Å£„Åã„Åë„ÄÇ"
    },
    {
        id: 'p1-2', part: 1, type: 'listening', contextType: 'image',
        imageUrl: "https://placehold.co/600x400/22c55e/white?text=Construction+Site",
        script: "(A) The women are wearing their protective gloves. (B) The women are touching the wall. (C) The women are forming a circle. (D) The women are working at the construction site.",
        question: "ÂÜôÁúü„ÅÆÊèèÂÜô„Å®„Åó„Å¶ÊúÄ„ÇÇÈÅ©Âàá„Å™„ÇÇ„ÅÆ„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ„ÄÇ",
        options: ["(A)", "(B)", "(C)", "(D)"],
        correct: 3,
        explanation: "„Éò„É´„É°„ÉÉ„Éà„ÇÑÂ∑•ÂÖ∑„ÅåË¶ã„Åà„Çã„Åü„ÇÅ„ÄÅÂª∫Ë®≠ÁèæÂ†¥(construction site)„ÅßÂÉç„ÅÑ„Å¶„ÅÑ„Çã(D)„ÅåÊ≠£Ëß£„ÄÇ"
    },

    // --- Part 2: Question-Response ---
    {
        id: 'p2-1', part: 2, type: 'listening', contextType: 'dialogue',
        script: "Will you be visiting the client tomorrow afternoon?",
        question: "Ë≥™Âïè„Å´ÂØæ„Åô„ÇãÈÅ©Âàá„Å™ÂøúÁ≠î„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ„ÄÇ",
        options: [
            "(A) Yes, it was yesterday.",
            "(B) I have an appointment at three P.M.",
            "(C) We haven't received any invitation yet."
        ],
        correct: 1,
        explanation: "„ÄåÊòéÊó•„ÅÆÂçàÂæå„ÄÅÈ°ßÂÆ¢„ÇíË®™Âïè„Åó„Åæ„Åô„ÅãÔºü„Äç„Å®„ÅÑ„ÅÜ‰∫àÂÆö„ÅÆË≥™Âïè„Å´ÂØæ„Åó„ÄÅ„Äå3ÊôÇ„Å´Á¥ÑÊùü„Åå„ÅÇ„Çã„Äç„Å®Á≠î„Åà„Å¶„ÅÑ„Çã(B)„ÅåÊ≠£Ëß£„ÄÇ"
    },
    {
        id: 'p2-2', part: 2, type: 'listening', contextType: 'dialogue',
        script: "Why hasn't the shipment arrived yet?",
        question: "Ë≥™Âïè„Å´ÂØæ„Åô„ÇãÈÅ©Âàá„Å™ÂøúÁ≠î„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ„ÄÇ",
        options: [
            "(A) No, I haven't.",
            "(B) Because of the heavy snow.",
            "(C) Usually by truck."
        ],
        correct: 1,
        explanation: "ÈÖçÈÄÅ„ÅåÈÅÖ„Çå„Å¶„ÅÑ„ÇãÁêÜÁî±(Why)„ÇíËÅû„ÅÑ„Å¶„ÅÑ„Çã„ÅÆ„Åß„ÄÅÂéüÂõ†(Because...)„ÇíËø∞„Åπ„Å¶„ÅÑ„Çã(B)„ÅåÊ≠£Ëß£„ÄÇ"
    },

    // --- Part 3: Conversations ---
    {
        id: 'p3-1', part: 3, type: 'listening', contextType: 'conversation',
        contextTitle: "Office: Copier Problem",
        script: `W: There seems to be something wrong with this copier. The red light is blinking.
M: Is it broken again? That's the third time this week.
W: I've got to make fifty copies by noon, so I'll use the one on the 3rd floor.
M: Let me see... maybe it's a paper jam. We'd better call a repairman.`,
        question: "What are the speakers talking about?",
        options: ["Lights", "A copy machine", "Planes", "Breakfast"],
        correct: 1,
        explanation: "„Ç≥„Éî„ÉºÊ©ü(copier)„ÅÆË™øÂ≠ê„ÅåÊÇ™„ÅÑ„Åì„Å®„Å´„Å§„ÅÑ„Å¶Ë©±„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ"
    },
    {
        id: 'p3-2', part: 3, type: 'listening', contextType: 'conversation',
        // Âêå„Åò„Çπ„ÇØ„É™„Éó„Éà„ÇíÂÖ±Êúâ
        script: `(Refer to previous conversation about the copier...)
M: ...We'd better call a repairman.`,
        question: "What will the man probably do next?",
        options: ["Go to a different floor", "Call a technician", "Complain to his boss", "Spend hours at his desk"],
        correct: 1,
        explanation: "Áî∑ÊÄß„ÅØÊúÄÂæå„Å´ repairmanÔºà‰øÆÁêÜÂ∑•Ôºâ„ÇíÂëº„Å∂„Å®Ë®Ä„Å£„Å¶„ÅÑ„Çã„Åü„ÇÅ„ÄÅ(B) Call a technician „ÅåÊ≠£Ëß£„ÄÇ"
    },

    // --- Part 4: Talks ---
    {
        id: 'p4-1', part: 4, type: 'listening', contextType: 'monologue',
        contextTitle: "Announcement: Starlight Cruise",
        script: "Welcome to the Starlight Cruise. Our ship cruises the West River... The tour includes a four-course meal, open bar, and live musical entertainment.",
        question: "What is included in the cruise?",
        options: ["Four meals", "Films", "A musical performance", "Fireworks"],
        correct: 2,
        explanation: "„Ç¢„Éä„Ç¶„É≥„ÇπÂÜÖ„Åß 'live musical entertainment' „ÅåÂê´„Åæ„Çå„Çã„Å®Ëø∞„Åπ„Çâ„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ"
    }
];

// „É™„Éº„Éá„Ç£„É≥„Ç∞„Çª„ÇØ„Ç∑„Éß„É≥ (Part 5 - 7)
const READING_QUESTION_DATA = [
    // --- Part 5: Incomplete Sentences ---
    {
        id: 'p5-1', part: 5, type: 'reading', contextType: 'sentence',
        question: "Harvey Daveson Auto Bike Co. is now working towards _______ to a problem that has emerged recently.",
        options: ["a cause", "an explanation", "a result", "a solution"],
        correct: 3,
        explanation: "ÊñáËÑàÂïèÈ°å„ÄÇ„ÄåÂïèÈ°å„Å∏„ÅÆËß£Ê±∫Á≠ñ(solution to a problem)„Äç„Å´Âèñ„ÇäÁµÑ„Çì„Åß„ÅÑ„Çã„Å®„Åô„Çã„ÅÆ„ÅåËá™ÁÑ∂„ÄÇ(D)„ÅåÊ≠£Ëß£„ÄÇ"
    },
    {
        id: 'p5-2', part: 5, type: 'reading', contextType: 'sentence',
        question: "Please _______ all the blanks on the order form to ensure prompt shipment.",
        options: ["fall on", "feel for", "fill in", "find out"],
        correct: 2,
        explanation: "ÁÜüË™ûÂïèÈ°å„ÄÇfill inÔºàË®òÂÖ•„Åô„ÇãÔºâ„ÅåÊñáËÑàÔºàÊ≥®ÊñáÊõ∏„ÅÆÁ©∫Ê¨ÑÔºâ„Å´Âêà„ÅÑ„Åæ„Åô„ÄÇ"
    },

    // --- Part 6: Text Completion ---
    {
        id: 'p6-1', part: 6, type: 'reading', contextType: 'long_text',
        contextTitle: "Memo: Acquisition",
        passage: "To: All employees\nFrom: James White\nRe: Acquisition by Ito Industries\n\nAs you already know, White Corporation _______ by Ito Industries and is now part of the Ito Group.",
        question: "Choose the best word for the blank.",
        options: ["have taken over", "have been taken over", "took over", "has been taken over"],
        correct: 3,
        explanation: "ÂèóÂãïÊÖã„ÅÆÊñáËÑà„ÄÇWhite CorporationÔºàÂçòÊï∞Ôºâ„Åå‰∏ªË™û„Å™„ÅÆ„Åß„ÄÅhas been taken over (D)„ÅåÊ≠£Ëß£„ÄÇ"
    },

    // --- Part 7: Reading Comprehension ---
    {
        id: 'p7-1', part: 7, type: 'reading', contextType: 'long_text',
        contextTitle: "Web Page: Richmond Hotel",
        passage: `The Richmond Hotel for both business and pleasure.
Located in the business district of Columbus.
Only 30 minutes from downtown Kensington and 25 minutes from Patterson International Airport.
All rooms are equipped with: Alarm clock radio, Coffee maker, Cable TV, Free Wi-Fi.`,
        question: "Where is the establishment situated?",
        options: ["In the center of the city", "Next to the airport", "In downtown Kensington", "In the business district"],
        correct: 3,
        explanation: "Êú¨Êñá„Å´ 'located in the business district of Columbus' „Å®ÊòéË®ò„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ"
    },
    {
        id: 'p7-2', part: 7, type: 'reading', contextType: 'long_text',
        contextTitle: "Web Page: Richmond Hotel",
        passage: `(Refer to the Richmond Hotel advertisement above...)
All rooms are equipped with: Alarm clock radio, Coffee maker, Cable TV, Free Wi-Fi, Microwave, Fridge.`,
        question: "What can be found in the rooms?",
        options: ["A computer", "A dishwasher", "An oven", "A microwave"],
        correct: 3,
        explanation: "Ë®≠ÂÇô„É™„Çπ„Éà„Å´ 'Microwave' „ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ(C) An oven „ÅØÈõªÂ≠ê„É¨„É≥„Ç∏(microwave oven)„ÅÆ‰∏ÄÁ®Æ„Å®ËÄÉ„Åà„Çâ„Çå„Çã„Åü„ÇÅ„ÄÅË®≠Âïè„Å´„Çà„Å£„Å¶„ÅØÊ≠£Ëß£„Å´„Å™„ÇäÂæó„Åæ„Åô„Åå„ÄÅ„Åì„Åì„Åß„ÅØÈÅ∏ÊäûËÇ¢„Å´Âêà„Çè„Åõ„Å¶Ë™øÊï¥„ÄÇ"
    }
];

        // ==========================================
        // UTILS (Evan/Samantha/Zoe ÊúÄÂÑ™ÂÖàÁâà)
        // ==========================================
        
        const stopAudio = () => {
             if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
            }
        };

        window.utterances = [];

        const speak = (text, onEnd) => {
            if (!('speechSynthesis' in window)) {
                if (onEnd) onEnd();
                return;
            }

            window.speechSynthesis.cancel();

            const lines = text.split(/\r?\n/).filter(line => line.trim() !== '');
            let voices = window.speechSynthesis.getVoices();
            
            // „Ç¢„Éä„Ç¶„É≥„Çπ(N)„ÅÆÊÄßÂà•„Çí„É©„É≥„ÉÄ„É†Ê±∫ÂÆö
            const randomBaseGender = Math.random() < 0.5 ? 'M' : 'W';

            const getVoiceConfig = (type) => {
                const targetGender = (type === 'N') ? randomBaseGender : type;

                // Ëã±Ë™û„ÅÆÂ£∞„Çí„Åô„Åπ„Å¶ÂèñÂæó
                const enVoices = voices.filter(v => v.lang.startsWith('en'));
                
                let selectedVoice = enVoices[0] || voices[0];
                let pitch = 1.0;
                let rate = 0.9;

                // ‚òÖ„ÅîÊåáÂÆö„ÅÆ„Éú„Ç§„Çπ„ÇíÂÑ™ÂÖàÈ†Ü‰Ωç„É™„Çπ„Éà„ÅÆÊúÄ‰∏ä‰Ωç„Å´ÈÖçÁΩÆ„Åó„Åæ„Åó„Åü
                // „É™„Çπ„Éà„ÅÆ‰∏ä„Åã„ÇâÈ†Ü„Å´„ÄÅÁ´ØÊú´„Å´ÂÖ•„Å£„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ„Åó„Å¶„ÄÅÊúÄÂàù„Å´Ë¶ã„Å§„Åã„Å£„Åü„ÇÇ„ÅÆ„Çí‰Ωø„ÅÑ„Åæ„Åô
                
                const malePriority = [
                    'Evan (Enhanced)', // ÊúÄÂÑ™ÂÖà: Evan Êã°ÂºµÁâà
                    'Evan',            // Ê¨°ÁÇπ: Evan Ê®ôÊ∫ñÁâà
                    'Daniel',          // Daniel (Ëã±ÂõΩ„Ç¢„ÇØ„Çª„É≥„Éà„Å†„ÅåÈùûÂ∏∏„Å´È´òÂìÅË≥™)
                    'Aaron',           // iOSÊ®ôÊ∫ñ
                    'Fred',
                    'Google US English Male'
                ];
                
                const femalePriority = [
                    'Samantha (Enhanced)', // ÊúÄÂÑ™ÂÖà: Samantha Êã°ÂºµÁâà
                    'Samantha',            // Ê¨°ÁÇπ: Samantha Ê®ôÊ∫ñÁâà
                    'Zoe (Enhanced)',      // Zoe Êã°ÂºµÁâà
                    'Zoe',                 // Zoe Ê®ôÊ∫ñÁâà
                    'Nicky',
                    'Google US English Female'
                ];

                if (targetGender === 'M') {
                    // --- Áî∑ÊÄß„Éë„Éº„Éà ---
                    // ÊåáÂÆö„É™„Çπ„Éà„Å´Âê´„Åæ„Çå„ÇãÂêçÂâç„ÅÆ„Éú„Ç§„Çπ„ÇíÊé¢„ÅôÔºàÂÆåÂÖ®‰∏ÄËá¥„Åæ„Åü„ÅØÈÉ®ÂàÜ‰∏ÄËá¥Ôºâ
                    const maleVoice = enVoices.find(v => malePriority.some(name => v.name.includes(name)));
                    
                    if (maleVoice) {
                        selectedVoice = maleVoice;
                        pitch = 1.0; 
                    } else {
                        // Ë¶ã„Å§„Åã„Çâ„Å™„ÅÑÂ†¥Âêà„ÅØ„Éá„Éï„Ç©„É´„Éà„Çí‰Ωé„Åè„Åó„Å¶ÂØæÂøú
                        pitch = 0.8; 
                    }
                } else if (targetGender === 'W') {
                    // --- Â•≥ÊÄß„Éë„Éº„Éà ---
                    const femaleVoice = enVoices.find(v => femalePriority.some(name => v.name.includes(name)));
                    
                    if (femaleVoice) {
                        selectedVoice = femaleVoice;
                        pitch = 1.0;
                    } else {
                        // Ë¶ã„Å§„Åã„Çâ„Å™„ÅÑÂ†¥Âêà„ÅØ„Éá„Éï„Ç©„É´„Éà„ÇíÂ∞ë„ÅóÈ´ò„Åè„Åó„Å¶ÂØæÂøú
                        pitch = 1.1;
                    }
                }

                return { voice: selectedVoice, pitch, rate };
            };

            let currentLine = 0;

            const playNextLine = () => {
                if (currentLine >= lines.length) {
                    window.utterances = [];
                    if (onEnd) onEnd();
                    return;
                }

                const line = lines[currentLine];
                let cleanText = line;
                let type = 'N';

                if (line.trim().match(/^[Mm](?:an)?[:\s]/)) {
                    type = 'M';
                    cleanText = line.replace(/^[Mm](?:an)?[:\s]\s*/, '');
                } else if (line.trim().match(/^[Ww](?:oman)?[:\s]/)) {
                    type = 'W';
                    cleanText = line.replace(/^[Ww](?:oman)?[:\s]\s*/, '');
                }

                const u = new SpeechSynthesisUtterance(cleanText);
                const config = getVoiceConfig(type);
                
                if (config.voice) u.voice = config.voice;
                u.pitch = config.pitch;
                u.rate = config.rate;
                u.lang = 'en-US'; 

                window.utterances.push(u);

                u.onend = () => {
                    currentLine++;
                    playNextLine();
                };
                
                u.onerror = (e) => {
                    if (e.error !== 'interrupted') console.error('Speech error', e);
                    currentLine++;
                    playNextLine();
                };

                window.speechSynthesis.speak(u);
            };

            playNextLine();
        };

        
        // ÈÖçÂàó„Çí„Ç∑„É£„ÉÉ„Éï„É´„Åô„ÇãÈñ¢Êï∞
        const shuffleArray = (array) => {
            return array.map(value => ({ value, sort: Math.random() }))
                        .sort((a, b) => a.sort - b.sort)
                        .map(({ value }) => value);
        };
        
        // ==========================================
        // COMPONENTS
        // ==========================================

        const Icon = ({ name, size = 24, className }) => {
    const ref = useRef(null);

    useEffect(() => {
        if (window.lucide && ref.current) {
            window.lucide.createIcons({
                root: ref.current,
                nameAttr: 'data-lucide',
            });
        }
    }, [name]);

    return (
        <span
            ref={ref}
            // ‰øÆÊ≠£ÁÇπ: 
            // - inline-flex: „Ç¢„Ç§„Ç≥„É≥„ÅÆÁÆ±„Çí‰Ωú„Çã
            // - items-center justify-center: ‰∏≠Ë∫´„ÅÆSVG„Çí„Å©Áúü„Çì‰∏≠„Å´
            // - leading-none: Ë°å„ÅÆÈ´ò„Åï„Å´„Çà„Çã‰∏ã„ÅÆ‰ΩôÁôΩ„ÇíÂâäÈô§
            // - align-middle: „ÉÜ„Ç≠„Çπ„Éà„ÅÆÊ®™„Å´‰∏¶„Çì„Å†ÊôÇ„ÅÆ‰ΩçÁΩÆ„Ç∫„É¨Èò≤Ê≠¢
            // - shrink-0: Áã≠„ÅÑÂ†¥ÊâÄ„Åß„ÇÇÊΩ∞„Çå„Å™„ÅÑ„Çà„ÅÜ„Å´„Åô„Çã
            className={`inline-flex items-center justify-center leading-none align-middle shrink-0 ${className || ''}`}
            style={{ width: size, height: size }}
        >
            <i 
                data-lucide={name} 
                width={size} 
                height={size} 
                // SVGËá™‰Ωì„ÇÇË¶™Ë¶ÅÁ¥†„ÅÑ„Å£„Å±„ÅÑ„Å´Â∫É„Åí„Çã
                style={{ display: 'block' }} 
            ></i>
        </span>
    );
};

        const Button = ({ children, onClick, className = "", variant = "primary", disabled = false, fullWidth = false }) => {
            const playSFX = useContext(SoundContext);
            
            const baseClass = `relative px-4 py-3.5 rounded-2xl font-bold flex items-center justify-center gap-2 btn-press no-select disabled:opacity-50 disabled:pointer-events-none transition-all duration-300 ${fullWidth ? 'w-full' : ''}`;
            
            const variants = {
                primary: "bg-yellow-500 hover:bg-yellow-400 text-slate-900 shadow-lg shadow-yellow-500/20 border border-yellow-400",
                secondary: "bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-200 hover:bg-slate-300 dark:hover:bg-slate-600",
                glass: "glass-panel border border-white/20 dark:border-slate-600 text-slate-800 dark:text-white hover:bg-white/40 dark:hover:bg-slate-700/50",
                ghost: "text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800",
                danger: "bg-red-500 text-white shadow-lg shadow-red-500/20"
            };

            const handleClick = (e) => {
                if (!disabled) {
                    playSFX('click');
                    if (onClick) onClick(e);
                }
            };

            return (
                <button onClick={handleClick} className={`${baseClass} ${variants[variant]} ${className}`} disabled={disabled}>
                    {children}
                </button>
            );
        };

        const Toggle = ({ checked, onChange }) => (
    <div 
        // ËÉåÊôØËâ≤Ôºàbg-gray-300„Å™„Å©Ôºâ„ÇíÊù°‰ª∂ÂàÜÂ≤ê„ÅÆ‰∏≠„Å´ÁßªÂãï„Åï„Åõ„ÄÅÁ´∂Âêà„ÇíÈò≤„Åé„Åæ„Åô
        className={`w-14 h-8 flex items-center rounded-full p-1 cursor-pointer transition-all duration-300 border ${checked ? 'bg-yellow-500 border-yellow-400' : 'bg-gray-300 dark:bg-slate-700 border-transparent'}`}
        onClick={onChange}
    >
        <div className={`bg-white w-6 h-6 rounded-full shadow-md transform transition-transform duration-300 ease-spring ${checked ? 'translate-x-6' : ''}`}></div>
    </div>
);

        const Header = ({ title, sub, leftIcon, onLeftClick, rightAction }) => (
            <div className="flex items-center justify-between p-4 glass-panel sticky top-0 z-30 border-b border-gray-200/50 dark:border-slate-800/50 no-select transition-all">
                <div className="flex items-center gap-3">
                    {leftIcon && (
                        <button onClick={onLeftClick} className="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-slate-700/50 transition">
                            <Icon name={leftIcon} className="w-6 h-6 text-slate-600 dark:text-slate-300" />
                        </button>
                    )}
                    <div>
                        <h1 className="text-lg font-bold text-slate-800 dark:text-slate-100 leading-tight tracking-tight">{title}</h1>
                        {sub && <p className="text-xs text-slate-500 dark:text-slate-400 font-medium">{sub}</p>}
                    </div>
                </div>
                {rightAction && <div>{rightAction}</div>}
            </div>
        );

        // ==========================================
// COUNTDOWN WIDGET („Éï„Ç©„É≥„ÉàÁµ±‰∏ÄÁâà)
// ==========================================
const CountdownWidget = () => {
    const [timeLeft, setTimeLeft] = useState(null);
    const TARGET_DATE = new Date("2026-01-23T14:00:00+09:00"); 

    useEffect(() => {
        const calculateTime = () => {
            const now = new Date();
            const diff = TARGET_DATE - now;
            if (diff <= 0) return null;
            return {
                days: Math.floor(diff / (1000 * 60 * 60 * 24)),
                hours: Math.floor((diff / (1000 * 60 * 60)) % 24),
            };
        };
        setTimeLeft(calculateTime());
        const timer = setInterval(() => setTimeLeft(calculateTime()), 60000); 
        return () => clearInterval(timer);
    }, []);

    if (!timeLeft) return null;

    return (
        <div className="mb-8 animate-slide-up relative z-10">
            <div className="bg-white dark:bg-slate-800 p-4 rounded-2xl border border-gray-200 dark:border-slate-700 shadow-sm flex items-center justify-between">
                
                {/* Â∑¶ÂÅ¥: Ë©¶È®ìÊó•ÊÉÖÂ†± */}
                <div className="flex items-center gap-3">
                    <div className="w-10 h-10 rounded-full bg-indigo-50 dark:bg-indigo-900/20 flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-indigo-500">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                    </div>
                    <div>
                        <p className="text-[10px] font-bold text-slate-400 uppercase tracking-wider">TOEIC ÂΩìÊó•„Åæ„Åß</p>
                        {/* ‰øÆÊ≠£: font-mono „ÇíÂâäÈô§„Åó„Å¶Ê®ôÊ∫ñ„Éï„Ç©„É≥„Éà„Å´ */}
                        <p className="text-sm font-bold text-slate-700 dark:text-slate-200">2026.01.23</p>
                    </div>
                </div>

                {/* Âè≥ÂÅ¥: ÊÆã„ÇäÊôÇÈñì */}
                <div className="text-right">
                    <div className="flex items-baseline justify-end gap-1">
                        {/* ‰øÆÊ≠£: font-mono „ÇíÂâäÈô§„Åó„Å¶Ê®ôÊ∫ñ„Éï„Ç©„É≥„Éà„Å´ */}
                        <span className="text-2xl font-black text-slate-800 dark:text-white tracking-tight">
                            {timeLeft.days}
                        </span>
                        <span className="text-xs font-bold text-slate-400 mr-2">days</span>
                        
                        {/* ‰øÆÊ≠£: font-mono „ÇíÂâäÈô§„Åó„Å¶Ê®ôÊ∫ñ„Éï„Ç©„É≥„Éà„Å´ */}
                        <span className="text-xl font-bold text-slate-800 dark:text-white tracking-tight">
                            {timeLeft.hours}
                        </span>
                        <span className="text-xs font-bold text-slate-400">hr</span>
                    </div>
                </div>
            </div>
        </div>
    );
};
        // ==========================================
        // COURSE SELECTION
        // ==========================================
        const CourseSelection = ({ type, onSelect, onBack }) => {
            const getCourses = () => {
                if (type === 'vocab') {
                    return [
                        { id: 'all', title: 'ÂÖ®„É¨„Éô„É´Á∑èÂêà', sub: '„É©„É≥„ÉÄ„É†„Å´Âá∫È°å', icon: 'layers', color: 'text-blue-500', bg: 'bg-blue-100 dark:bg-blue-900/30' },
                        { id: 'weak', title: 'Ëã¶ÊâãÂÖãÊúç', sub: 'Êú™ÁøíÂæó„ÅÆÂçòË™û„ÅÆ„Åø', icon: 'target', color: 'text-red-500', bg: 'bg-red-100 dark:bg-red-900/30' },
                        { id: '600', title: 'Level 600', sub: 'Âü∫Á§é„ÉªÂøÖÈ†à„É¨„Éô„É´', icon: 'zap', color: 'text-green-500', bg: 'bg-green-100 dark:bg-green-900/30' },
                        { id: '730', title: 'Level 730', sub: '„Éì„Ç∏„Éç„ÇπÊ®ôÊ∫ñ', icon: 'briefcase', color: 'text-yellow-500', bg: 'bg-yellow-100 dark:bg-yellow-900/30' },
                        { id: '860', title: 'Level 860+', sub: '„Éè„Ç§„Çπ„Ç≥„Ç¢„ÉªÈõ£Èñ¢', icon: 'award', color: 'text-purple-500', bg: 'bg-purple-100 dark:bg-purple-900/30' },
                    ];
                } else if (type === 'listening') {
            return [
                { id: 'all_listening', title: '„É™„Çπ„Éã„É≥„Ç∞Á∑èÂêà', sub: 'Part 1 - 4 „É©„É≥„ÉÄ„É†', icon: 'headphones', color: 'text-indigo-500', bg: 'bg-indigo-100 dark:bg-indigo-900/30' },
                { id: 'part1', title: 'Part 1: ÂÜôÁúüÊèèÂÜô', sub: 'ÁîªÂÉè„ÇíË¶ã„Å¶Á≠î„Åà„Çã', icon: 'image', color: 'text-pink-500', bg: 'bg-pink-100 dark:bg-pink-900/30' },
                { id: 'part2', title: 'Part 2: ÂøúÁ≠îÂïèÈ°å', sub: 'Ë≥™Âïè„Å∏„ÅÆÂøúÁ≠î„ÇíÈÅ∏„Å∂', icon: 'message-circle', color: 'text-green-500', bg: 'bg-green-100 dark:bg-green-900/30' },
                { id: 'part3', title: 'Part 3: ‰ºöË©±ÂïèÈ°å', sub: 'Ë§áÊï∞‰∫∫„ÅÆ‰ºöË©±„ÇíËÅû„Åè', icon: 'users', color: 'text-blue-500', bg: 'bg-blue-100 dark:bg-blue-900/30' },
                { id: 'part4', title: 'Part 4: Ë™¨ÊòéÊñá', sub: '„Ç¢„Éä„Ç¶„É≥„ÇπÁ≠â„ÇíËÅû„Åè', icon: 'radio', color: 'text-orange-500', bg: 'bg-orange-100 dark:bg-orange-900/30' },
            ];
        } else if (type === 'reading') {
            return [
                { id: 'all_reading', title: '„É™„Éº„Éá„Ç£„É≥„Ç∞Á∑èÂêà', sub: 'Part 5 - 7 „É©„É≥„ÉÄ„É†', icon: 'book-open', color: 'text-teal-500', bg: 'bg-teal-100 dark:bg-teal-900/30' },
                { id: 'part5', title: 'Part 5: Áü≠ÊñáÁ©¥Âüã„ÇÅ', sub: 'ÊñáÊ≥ï„ÉªË™ûÂΩôÂäõ', icon: 'edit-3', color: 'text-yellow-500', bg: 'bg-yellow-100 dark:bg-yellow-900/30' },
                { id: 'part6', title: 'Part 6: Èï∑ÊñáÁ©¥Âüã„ÇÅ', sub: 'ÊñáËÑàÁêÜËß£', icon: 'file-text', color: 'text-cyan-500', bg: 'bg-cyan-100 dark:bg-cyan-900/30' },
                { id: 'part7', title: 'Part 7: Ë™≠Ëß£ÂïèÈ°å', sub: 'Èï∑ÊñáË™≠Ëß£', icon: 'book', color: 'text-purple-500', bg: 'bg-purple-100 dark:bg-purple-900/30' },
            ];
        }
        return [];
            };

            const courses = getCourses();
    const sectionTitle = type === 'vocab' ? 'ÈáçË¶ÅË™ûÂè•' : type === 'listening' ? '„É™„Çπ„Éã„É≥„Ç∞ (Part 1-4)' : '„É™„Éº„Éá„Ç£„É≥„Ç∞ (Part 5-7)';

            // ‚òÖËøΩÂä†: iOSÂØæÁ≠ñ„ÅÆ„Çµ„Ç§„É¨„É≥„ÉàÂÜçÁîüÈñ¢Êï∞
    const handleSelectWithWarmup = (courseId) => {
        // iOS„Åß„ÅØ„É¶„Éº„Ç∂„Éº„Ç¢„ÇØ„Ç∑„Éß„É≥(„Çø„ÉÉ„Éó)„ÅÆ‰∏≠„Åß‰∏ÄÂ∫¶Èü≥Â£∞„ÇíÂÜçÁîü„Åó„Å¶„Åä„Åè„Å®„ÄÅ
        // „Åù„ÅÆÂæå„ÅÆËá™ÂãïÂÜçÁîü(useEffect„Å™„Å©)„ÅåË®±ÂèØ„Åï„Çå„Çã„Åì„Å®„ÅåÂ§ö„ÅÑ„ÄÇ
        if ('speechSynthesis' in window) {
            // ÁÑ°Èü≥„ÅÆÁü≠„ÅÑÁô∫Ë©±„Çí‰ΩúÊàê
            const silent = new SpeechSynthesisUtterance(" ");
            silent.volume = 0; // Èü≥Èáè0
            silent.duration = 0; // Áü≠„Åè
            window.speechSynthesis.speak(silent);
        }
        // Êú¨Êù•„ÅÆÂá¶ÁêÜ„ÇíÂÆüË°å
        onSelect(courseId);
    };

            return (
        <div className="flex flex-col h-full bg-gray-50 dark:bg-slate-900 animate-slide-in-right">
            <Header title={sectionTitle} sub="„Ç≥„Éº„Çπ„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ" leftIcon="arrow-left" onLeftClick={onBack} />
            <div className="p-4 space-y-3 overflow-y-auto pb-20">
                {courses.map((course, idx) => (
                    <button key={course.id} onClick={() => handleSelectWithWarmup(course.id)} className="w-full bg-white dark:bg-slate-800 p-4 rounded-2xl text-left border border-gray-200 dark:border-slate-700 shadow-sm hover:shadow-lg transition-all btn-press flex items-center gap-4 group" style={{ animationDelay: `${idx * 50}ms` }}>
                        <div className={`w-14 h-14 rounded-2xl flex items-center justify-center ${course.bg} group-hover:scale-110 transition-transform duration-300`}>
                            <Icon name={course.icon} className={course.color} size={26} />
                        </div>
                        <div className="flex-1">
                            <h3 className="font-bold text-lg text-slate-800 dark:text-slate-100">{course.title}</h3>
                            <p className="text-xs text-slate-500">{course.sub}</p>
                        </div>
                        <div className="w-8 h-8 rounded-full bg-gray-100 dark:bg-slate-700 flex items-center justify-center">
                            <Icon name="chevron-right" className="text-slate-400" size={18} />
                        </div>
                    </button>
                ))}
            </div>
        </div>
    );
};

        // ==========================================
// RESULT SCREEN (ÊºîÂá∫„Å™„Åó„Éª„Ç∑„É≥„Éó„É´Áâà)
// ==========================================
const ResultScreen = ({ score, total, onRetry, onHome }) => {
    // 0Èô§ÁÆóÂØæÁ≠ñ
    const percentage = total > 0 ? Math.round((score / total) * 100) : 0;
    
    const radius = 40;
    const circumference = 2 * Math.PI * radius;
    const strokeDashoffset = circumference - (percentage / 100) * circumference;

    let rank = 'C';
    let message = "Keep Going!";
    let color = "#94a3b8"; // slate

    if (percentage === 100) { rank = 'S'; message = "Perfect!!"; color = "#eab308"; }
    else if (percentage >= 80) { rank = 'A'; message = "Excellent!"; color = "#22c55e"; }
    else if (percentage >= 60) { rank = 'B'; message = "Good Job!"; color = "#3b82f6"; }

    return (
        <div className="flex flex-col h-full bg-gray-50 dark:bg-slate-900 animate-fade-in relative overflow-hidden">
            {/* „ÇØ„É©„ÉÉ„Ç´„ÉºÊºîÂá∫„ÅÆÂëº„Å≥Âá∫„Åó„Ç≥„Éº„Éâ„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü */}

            <div className="flex-1 flex flex-col items-center justify-center p-6 z-10">
                <div className="mb-2 text-sm font-bold tracking-widest text-slate-400 uppercase animate-slide-up">Result</div>
                <h2 className={`text-4xl font-black mb-8 animate-pop ${percentage === 100 ? 'gold-text' : 'text-slate-800 dark:text-white'}`}>
                    {message}
                </h2>

                <div className="relative w-64 h-64 mb-8 animate-pop">
                    <svg viewBox="0 0 100 100" className="w-full h-full transform -rotate-90 drop-shadow-xl">
                        <circle
                            cx="50" cy="50" r={radius}
                            fill="none"
                            stroke="currentColor"
                            strokeWidth="8"
                            className="text-gray-200 dark:text-slate-700"
                        />
                        <circle
                            cx="50" cy="50" r={radius}
                            fill="none"
                            stroke={color}
                            strokeWidth="8"
                            strokeLinecap="round"
                            strokeDasharray={circumference}
                            strokeDashoffset={strokeDashoffset}
                            className="transition-all duration-1000 ease-out"
                        />
                    </svg>
                    
                    <div className="absolute inset-0 flex flex-col items-center justify-center text-slate-800 dark:text-white">
                        <div className="flex items-baseline justify-center">
                            <span className="text-6xl font-black tracking-tighter leading-none">
                                {percentage}
                            </span>
                            <span className="text-xl font-bold ml-1">%</span>
                        </div>
                        <span className="text-sm font-medium text-slate-500 uppercase tracking-widest mt-1">Accuracy</span>
                    </div>
                </div>

                <div className="grid grid-cols-2 gap-4 w-full max-w-sm mb-8 animate-slide-up" style={{ animationDelay: '0.2s' }}>
                    <div className="glass-panel p-4 rounded-2xl text-center border border-slate-200 dark:border-slate-700">
                        <p className="text-xs text-slate-500 mb-1">RANK</p>
                        <p className="text-2xl font-black" style={{ color: color }}>{rank}</p>
                    </div>
                    
                    <div className="glass-panel p-4 rounded-2xl text-center border border-slate-200 dark:border-slate-700">
                        <p className="text-xs text-slate-500 mb-1">CORRECT</p>
                        <p className="text-2xl font-black text-slate-800 dark:text-white">
                            {score} <span className="text-base text-slate-400 font-bold">/ {total}</span>
                        </p>
                    </div>
                </div>

                <div className="w-full max-w-sm space-y-3 animate-slide-up" style={{ animationDelay: '0.4s' }}>
                    <Button onClick={onRetry} variant="primary" fullWidth>
                        <Icon name="rotate-ccw" size={18} /> „ÇÇ„ÅÜ‰∏ÄÂ∫¶ÊåëÊà¶
                    </Button>
                    <Button onClick={onHome} variant="secondary" fullWidth>
                        <Icon name="home" size={18} /> „Éõ„Éº„É†„Å∏Êàª„Çã
                    </Button>
                </div>
            </div>
        </div>
    );
};
        // ==========================================
// QUIZ SESSION (Èü≥Â£∞ÂØæÂøú„Éª‰øÆÊ≠£Áâà v3)
// ==========================================
const QuizSession = ({ rawData, mode, filterId, isDrillMode, onFinish }) => {
    const playSFX = useContext(SoundContext);
    const [gameState, setGameState] = useState('loading'); 
    const [sessionData, setSessionData] = useState([]);
    const [currentIndex, setCurrentIndex] = useState(0);
    const [selected, setSelected] = useState(null);
    const [isCorrect, setIsCorrect] = useState(null);
    const [sessionStreak, setSessionStreak] = useState(0); 
    const [score, setScore] = useState(0);
    const [showExplanation, setShowExplanation] = useState(false);
    const [isLocked, setIsLocked] = useState(false);
    const [timeLeft, setTimeLeft] = useState(0);
    
    // Èü≥Â£∞ÂÜçÁîü‰∏≠„Åã„Å©„ÅÜ„Åã„ÇíÁÆ°ÁêÜ„Åô„Çã„Éï„É©„Ç∞
    const [isAudioPlaying, setIsAudioPlaying] = useState(false);
    
    const [retryCount, setRetryCount] = useState(0);

    // ÂïèÈ°å„Éá„Éº„Çø„ÅÆ„Éï„Ç£„É´„Çø„É™„É≥„Ç∞„Å®„É≠„Éº„Éâ
    useEffect(() => {
        setGameState('loading');

        let filtered = [...rawData];
        const savedProgress = JSON.parse(localStorage.getItem('toeic_progress_v3') || '{}');
        
        if (mode === 'vocab') {
             if (filterId === 'weak') filtered = filtered.filter(item => { const p = savedProgress[item.id]; return !p || !p.mastered; });
             else if (filterId === '600') filtered = filtered.filter(item => item.level === 600);
             else if (filterId === '730') filtered = filtered.filter(item => item.level === 730);
             else if (filterId === '860') filtered = filtered.filter(item => item.level >= 860);
        } else if (mode === 'listening') {
             if (filterId.startsWith('part')) filtered = filtered.filter(i => i.part === parseInt(filterId.replace('part','')));
        } else if (mode === 'reading') {
             if (filterId.startsWith('part')) filtered = filtered.filter(i => i.part === parseInt(filterId.replace('part','')));
        }
        
        if (isDrillMode) {
            filtered = filtered.filter(item => { const p = savedProgress[item.id]; return !p || !p.mastered; });
        }
        
        if (filtered.length === 0) {
             let originalScope = [...rawData];
             if (mode === 'vocab') {
                if (filterId === '600') originalScope = originalScope.filter(item => item.level === 600);
                else if (filterId === '730') originalScope = originalScope.filter(item => item.level === 730);
                else if (filterId === '860') originalScope = originalScope.filter(item => item.level >= 860);
            } else if (mode === 'listening' && filterId.startsWith('part')) {
                 originalScope = originalScope.filter(i => i.part === parseInt(filterId.replace('part','')));
            } else if (mode === 'reading' && filterId.startsWith('part')) {
                 originalScope = originalScope.filter(i => i.part === parseInt(filterId.replace('part','')));
            }

            if (originalScope.length > 0) {
                setGameState('mastered');
                return;
            } else {
                alert("Âá∫È°å„Åß„Åç„ÇãÂïèÈ°å„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ");
                onFinish(0);
                return;
            }
        }
        
        setSessionData(shuffleArray(filtered).slice(0, 10));
        setTimeout(() => setGameState('playing'), 100);

    }, [rawData, mode, filterId, isDrillMode, retryCount]);


    const currentItem = sessionData[currentIndex];

    // --- Èü≥Â£∞Âà∂Âæ°„Å®„Çø„Ç§„Éû„Éº„É≠„Ç∏„ÉÉ„ÇØ ---
    
    // 1. ÂïèÈ°åÂàá„ÇäÊõø„ÅàÊôÇ„ÅÆËá™ÂãïÂÜçÁîü
    useEffect(() => {
        if (gameState !== 'playing' || !currentItem) return;

        // Ââç„ÅÆÈü≥Â£∞„ÇíÂÅúÊ≠¢
        stopAudio();
        setIsAudioPlaying(false);

        // „É™„Çπ„Éã„É≥„Ç∞„É¢„Éº„Éâ„Å™„ÇâËá™ÂãïÂÜçÁîü
        if (mode === 'listening') {
            setIsAudioPlaying(true);
            speak(currentItem.script, () => {
                setIsAudioPlaying(false);
            });
        }
    }, [currentIndex, gameState, mode]); 

    // 2. „Ç≥„É≥„Éù„Éº„Éç„É≥„ÉàÁ†¥Ê£ÑÊôÇ„Å´ÂÅúÊ≠¢
    useEffect(() => {
        return () => {
            stopAudio();
        };
    }, []);
    
    // 3. „Çø„Ç§„Éû„Éº„Ç´„Ç¶„É≥„Éà„ÉÄ„Ç¶„É≥ÔºàÈü≥Â£∞ÂÜçÁîü‰∏≠„ÅØÂÅúÊ≠¢Ôºâ
    useEffect(() => {
        if (gameState !== 'playing' || showExplanation || !currentItem || isAudioPlaying) return;
        
        const timer = setInterval(() => {
            setTimeLeft(prev => {
                if (prev <= 1) {
                    clearInterval(timer);
                    handleTimeUp();
                    return 0;
                }
                return prev - 1;
            });
        }, 1000);
        return () => clearInterval(timer);
    }, [currentIndex, showExplanation, gameState, isAudioPlaying]);


    const currentItemStreak = useMemo(() => {
        if (!currentItem) return 0;
        const savedProgress = JSON.parse(localStorage.getItem('toeic_progress_v3') || '{}');
        return savedProgress[currentItem.id]?.streak || 0;
    }, [currentItem, isCorrect]);
    
    const getMaxTime = () => {
        if (mode === 'vocab') return 10;
        if (mode === 'reading') {
            if (currentItem?.part === 7) return 60;
            return 20;
        }
        return 15;
    };
    const maxTime = getMaxTime();

    // „Çø„Ç§„Éû„ÉºÂàùÊúüÂåñ
    useEffect(() => {
        if (gameState === 'playing') setTimeLeft(maxTime);
    }, [currentIndex, maxTime, gameState]);

    const choices = useMemo(() => {
        if (!currentItem) return [];
        if (mode === 'vocab') return shuffleArray([...currentItem.choices, currentItem.meaning]);
        return currentItem.options || currentItem.choices; 
    }, [currentItem, mode]);

    const handleTimeUp = () => {
        stopAudio();
        playSFX('wrong');
        setIsCorrect(false);
        setShowExplanation(true);
        updateProgress(false);
    };

    const updateProgress = (isAnswerCorrect) => {
        const savedData = JSON.parse(localStorage.getItem('toeic_progress_v3') || '{}');
        const itemData = savedData[currentItem.id] || { streak: 0, mastered: false };
        if (isAnswerCorrect) {
            itemData.streak += 1; 
            const threshold = isDrillMode ? 2 : 1; 
            if (itemData.streak >= threshold) itemData.mastered = true;
        } else {
            itemData.streak = 0;
        }
        savedData[currentItem.id] = itemData;
        localStorage.setItem('toeic_progress_v3', JSON.stringify(savedData));
    };

    const handleAnswer = (choice, index) => {
        if (isLocked || showExplanation) return;
        
        stopAudio(); // ÂõûÁ≠îÊôÇ„Å´ÂÅúÊ≠¢
        
        setIsLocked(true);
        setSelected(index);
        
        let correct = false;
        if (mode === 'vocab') correct = (choice === currentItem.meaning);
        else correct = (index === currentItem.correct);

        setIsCorrect(correct);
        playSFX(correct ? 'correct' : 'wrong');

        if (correct) {
            setScore(s => s + 1);
            setSessionStreak(s => s + 1);
        } else {
            setSessionStreak(0);
        }

        updateProgress(correct);

        setTimeout(() => {
            if (correct) {
                if (mode === 'vocab') nextQuestion();
                else setShowExplanation(true);
            } else {
                setShowExplanation(true);
            }
            setIsLocked(false);
        }, correct && mode === 'vocab' ? 800 : 500);
    };

    const nextQuestion = () => {
        stopAudio(); // Ê¨°„Å∏Ë°å„ÅèÊôÇ„Å´ÂÅúÊ≠¢
        if (currentIndex >= sessionData.length - 1) {
            playSFX('complete');
            setGameState('result');
        } else {
            setCurrentIndex(prev => prev + 1);
            setSelected(null);
            setIsCorrect(null);
            setShowExplanation(false);
            setTimeLeft(maxTime);
            setIsLocked(false);
        }
    };
    
    const handleResetCourse = () => {
        if(!confirm("„Åì„ÅÆ„Ç≥„Éº„Çπ„ÅÆÂ≠¶Áøí„Éá„Éº„Çø„Çí„É™„Çª„ÉÉ„Éà„Åó„Å¶„ÄÅÊúÄÂàù„Åã„ÇâÁâπË®ì„ÅóÁõ¥„Åó„Åæ„Åô„ÅãÔºü")) return;
        const savedData = JSON.parse(localStorage.getItem('toeic_progress_v3') || '{}');
        let targetItems = [...rawData];
        
        if (mode === 'vocab' && filterId === '600') targetItems = targetItems.filter(i => i.level === 600);
        
        targetItems.forEach(item => {
            if (savedData[item.id]) savedData[item.id] = { streak: 0, mastered: false };
        });
        localStorage.setItem('toeic_progress_v3', JSON.stringify(savedData));
        alert("„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„ÅüÔºÅ");
        stopAudio();
        onFinish(0); 
    };

    const handleRetry = () => {
        stopAudio();
        setScore(0);
        setSessionStreak(0);
        setCurrentIndex(0);
        setSelected(null);
        setIsCorrect(null);
        setShowExplanation(false);
        setIsLocked(false);
        setRetryCount(prev => prev + 1);
    };
    
    // ÁµÇ‰∫Ü„Éú„Çø„É≥„ÉªÈñâ„Åò„Çã„Éú„Çø„É≥„ÅÆÂá¶ÁêÜ
    const handleFinish = () => {
        stopAudio();
        onFinish(sessionStreak);
    };

    // --- „É¨„É≥„ÉÄ„É™„É≥„Ç∞ ---

    if (gameState === 'mastered') {
        return (
            <div className="h-full flex flex-col items-center justify-center p-6 bg-gray-50 dark:bg-slate-900 animate-pop">
                <div className="bg-white dark:bg-slate-800 p-8 rounded-3xl shadow-xl text-center border border-gray-200 dark:border-slate-700 max-w-sm w-full">
                    <div className="w-20 h-20 bg-yellow-100 dark:bg-yellow-900/30 rounded-full flex items-center justify-center mx-auto mb-6 text-4xl">
                        üèÜ
                    </div>
                    <h2 className="text-2xl font-black text-slate-800 dark:text-white mb-2">COURSE MASTERED!</h2>
                    <p className="text-slate-500 dark:text-slate-400 mb-8">
                        „Åì„ÅÆ„Ç≥„Éº„Çπ„ÅÆÂïèÈ°å„ÅØ„Åô„Åπ„Å¶ÁøíÂæóÊ∏à„Åø„Åß„Åô„ÄÇ<br/>
                        „É™„Çª„ÉÉ„Éà„Åó„Å¶Âæ©Áøí„Åó„Åæ„Åô„ÅãÔºü
                    </p>
                    <div className="space-y-3">
                        <Button onClick={handleResetCourse} variant="primary" fullWidth>
                            <Icon name="rotate-ccw" size={20} /> „É™„Çª„ÉÉ„Éà„Åó„Å¶„ÇÑ„ÇäÁõ¥„Åô
                        </Button>
                        <Button onClick={handleFinish} variant="secondary" fullWidth>
                            <Icon name="x" size={20} /> Èñâ„Åò„Çã
                        </Button>
                    </div>
                </div>
            </div>
        );
    }

    if (gameState === 'result') {
        return <ResultScreen score={score} total={sessionData.length} onRetry={handleRetry} onHome={handleFinish} />;
    }

    if (!currentItem || gameState !== 'playing') {
        return (
             <div className="h-full flex flex-col items-center justify-center bg-gray-50 dark:bg-slate-900">
                <Icon name="loader-2" className="animate-spin text-yellow-500 mb-2" size={32} />
                <span className="text-slate-500 text-sm font-bold animate-pulse">Loading...</span>
            </div>
        );
    }

    const timerWidth = (timeLeft / maxTime) * 100;
    const timerColor = timeLeft <= 5 ? "bg-red-500" : "bg-blue-500";
    const barColor = isAudioPlaying ? "bg-green-500" : timerColor;

    // „Éò„ÉÉ„ÉÄ„Éº„Çµ„Éñ„Çø„Ç§„Éà„É´
    const headerSub = (
        <div className="flex items-center gap-3">
            <span>{currentIndex + 1} / {sessionData.length}</span>
            {isDrillMode && (
                <>
                    <span className="w-px h-3 bg-slate-300 dark:bg-slate-600"></span>
                    <div className="flex items-center gap-1.5">
                        <div className={`w-2.5 h-2.5 rounded-full border border-slate-300 dark:border-slate-500 transition-all duration-300 ${currentItemStreak >= 1 ? 'bg-yellow-500 border-yellow-500 shadow-[0_0_8px_rgba(234,179,8,0.6)]' : 'bg-transparent'}`}></div>
                        <div className={`w-2.5 h-2.5 rounded-full border border-slate-300 dark:border-slate-500 transition-all duration-300 ${currentItemStreak >= 2 ? 'bg-yellow-500 border-yellow-500 shadow-[0_0_8px_rgba(234,179,8,0.6)]' : 'bg-transparent'}`}></div>
                    </div>
                </>
            )}
        </div>
    );

    return (
        <div className="flex flex-col h-full bg-gray-50 dark:bg-slate-900 transition-colors">
            <Header 
                title={mode === 'vocab' ? 'ÂçòË™û„ÉÜ„Çπ„Éà' : `Part ${currentItem.part || '?'}`} 
                sub={headerSub} 
                leftIcon="x"
                onLeftClick={handleFinish}
            />

            {/* Progress Bar */}
            <div className="w-full h-1.5 bg-gray-200 dark:bg-slate-800 overflow-hidden relative">
                <div 
                    className={`h-full ${barColor} transition-all duration-1000 ease-linear shadow-[0_0_10px_rgba(59,130,246,0.5)]`} 
                    style={{ width: isAudioPlaying ? '100%' : `${timerWidth}%` }}
                ></div>
                {isAudioPlaying && (
                    <div className="absolute inset-0 flex items-center justify-center">
                        <div className="w-full h-full bg-green-500/20 animate-pulse"></div>
                    </div>
                )}
            </div>

            <div className={`flex-1 overflow-y-auto p-4 transition-all duration-300 ${showExplanation ? 'pb-[450px]' : 'pb-32'}`}>
                
                <div className="mb-6 space-y-4">
                    {/* VocabË°®Á§∫ */}
                    {mode === 'vocab' && (
                         <div className="text-center animate-pop my-8">
                            <span className="inline-block px-3 py-1 mb-4 text-xs font-bold text-slate-800 bg-yellow-400 rounded-full no-select shadow-sm">LEVEL {currentItem.level}</span>
                            <h2 className="text-4xl font-extrabold text-slate-800 dark:text-white mb-2 tracking-wide selectable-text drop-shadow-sm">{currentItem.word}</h2>
                        </div>
                    )}
                    
                    {/* ÁîªÂÉèË°®Á§∫ */}
                    {currentItem.contextType === 'image' && currentItem.imageUrl && (
                        <div className="rounded-2xl overflow-hidden shadow-lg border border-gray-200 dark:border-slate-700 animate-pop">
                            <img src={currentItem.imageUrl} alt="Question Context" className="w-full h-auto object-cover" />
                        </div>
                    )}
                    
                    {/* Èï∑ÊñáË°®Á§∫ */}
                    {currentItem.contextType === 'long_text' && (
                         <div className="glass-panel p-5 rounded-2xl border border-gray-200 dark:border-slate-700 shadow-sm animate-pop max-h-64 overflow-y-auto">
                            {currentItem.contextTitle && <h3 className="text-xs font-bold text-slate-400 mb-2 uppercase tracking-wider sticky top-0 bg-white/90 dark:bg-slate-800/90 backdrop-blur-sm py-1">{currentItem.contextTitle}</h3>}
                            <p className="text-sm leading-relaxed text-slate-700 dark:text-slate-300 whitespace-pre-wrap font-serif">{currentItem.passage}</p>
                        </div>
                    )}

                    {/* „É™„Çπ„Éã„É≥„Ç∞ÂÜçÁîü„Éú„Çø„É≥ */}
                    {mode === 'listening' && (
                        <div className="flex flex-col items-center justify-center py-4 animate-pop">
                            <button 
                                onClick={() => {
                                    stopAudio();
                                    setIsAudioPlaying(true);
                                    speak(currentItem.script, () => setIsAudioPlaying(false));
                                }}
                                disabled={isAudioPlaying}
                                className={`w-20 h-20 rounded-full border-4 flex items-center justify-center shadow-lg transition-transform ${isAudioPlaying ? 'bg-green-100 dark:bg-green-900/30 border-green-500 scale-110' : 'bg-yellow-100 dark:bg-yellow-900/30 border-yellow-500 btn-press hover:scale-105'}`}
                            >
                                {isAudioPlaying ? (
                                    <Icon name="volume-2" className="w-8 h-8 text-green-600 dark:text-green-500 animate-pulse" />
                                ) : (
                                    <Icon name="play" className="w-8 h-8 text-yellow-600 dark:text-yellow-500 ml-1" />
                                )}
                            </button>
                            <p className="mt-2 text-xs text-slate-500">
                                {isAudioPlaying ? "Listening..." : "Replay Audio"}
                            </p>
                            
                            {(showExplanation || currentItem.part >= 3) && (
                                <details className="w-full mt-4 group">
                                    <summary className="text-xs text-center text-slate-400 cursor-pointer hover:text-yellow-500 transition list-none select-none">
                                        <span className="border-b border-dashed border-slate-400 pb-0.5">„Çπ„ÇØ„É™„Éó„Éà„ÇíË°®Á§∫/ÈùûË°®Á§∫</span>
                                    </summary>
                                    <div className="mt-3 p-4 bg-white dark:bg-slate-800 rounded-xl text-xs text-slate-600 dark:text-slate-400 whitespace-pre-wrap border border-gray-200 dark:border-slate-700 shadow-inner text-left">
                                        {currentItem.script}
                                    </div>
                                </details>
                            )}
                        </div>
                    )}
                    
                    {/* ÂïèÈ°åÊñáË°®Á§∫ */}
                    {mode !== 'vocab' && currentItem.question && (
                        <div className="glass-panel p-4 rounded-xl border border-blue-100 dark:border-slate-700 bg-blue-50/50 dark:bg-slate-800/50 shadow-sm animate-pop">
                            <p className="text-lg font-medium text-slate-800 dark:text-slate-100 leading-relaxed">
                                <span className="text-blue-500 font-bold mr-2">Q.</span>
                                {currentItem.question}
                            </p>
                        </div>
                    )}
                </div>

                {/* ÈÅ∏ÊäûËÇ¢„Ç®„É™„Ç¢ */}
                <div className="space-y-3">
                    {choices.map((choice, idx) => {
                         let btnClass = "w-full p-4 rounded-xl text-left font-medium text-lg transition-all border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-sm hover:bg-gray-50 dark:hover:bg-slate-700";
                         
                         if (selected !== null) {
                            if (mode === 'vocab') {
                                if (choice === currentItem.meaning) btnClass = "w-full p-4 rounded-xl text-left font-bold border-2 border-green-500 bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400 shadow-md";
                                else if (idx === selected) btnClass = "w-full p-4 rounded-xl text-left border-2 border-red-500 bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400";
                                else btnClass += " opacity-40 blur-[1px]";
                            } else {
                                if (idx === currentItem.correct) btnClass = "w-full p-4 rounded-xl text-left font-bold border-2 border-green-500 bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400 shadow-md";
                                else if (idx === selected) btnClass = "w-full p-4 rounded-xl text-left border-2 border-red-500 bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400";
                                else btnClass += " opacity-40 blur-[1px]";
                            }
                        }

                         return (
                            <div key={idx} className="animate-slide-up" style={{ animationDelay: `${idx * 40}ms`, transform: 'translateZ(0)' }}>
                                <button onClick={() => handleAnswer(choice, idx)} disabled={selected !== null} className={`${btnClass} btn-press flex items-center`}>
                                    <span className="inline-flex items-center justify-center min-w-[28px] h-7 rounded-lg bg-gray-100 dark:bg-slate-700 text-slate-500 dark:text-slate-400 text-xs font-bold mr-3 shadow-inner">{String.fromCharCode(65 + idx)}</span>
                                    <span className="selectable-text text-sm md:text-base leading-relaxed">{choice}</span>
                                </button>
                            </div>
                        );
                    })}
                </div>
            </div>

            {/* Ëß£Ë™¨„É¢„Éº„ÉÄ„É´ */}
            {showExplanation && (
                <div className="fixed bottom-0 left-0 w-full glass-panel bg-white/95 dark:bg-slate-800/95 border-t border-gray-200 dark:border-slate-600 z-50 animate-slide-up shadow-[0_-10px_40px_rgba(0,0,0,0.2)] rounded-t-3xl" style={{ padding: '1.5rem', paddingBottom: 'calc(1.5rem + env(safe-area-inset-bottom))' }}>
                    <div className="max-w-md mx-auto">
                         <div className="flex items-center gap-3 mb-4">
                            {isCorrect ? (
                                <div className="w-10 h-10 rounded-full bg-green-500 flex items-center justify-center shrink-0 shadow-lg shadow-green-500/30 animate-pop"><Icon name="check" className="text-white w-6 h-6" /></div>
                            ) : (
                                <div className="w-10 h-10 rounded-full bg-red-500 flex items-center justify-center shrink-0 shadow-lg shadow-red-500/30 animate-pop"><Icon name="x" className="text-white w-6 h-6" /></div>
                            )}
                            <h3 className={`text-2xl font-black ${isCorrect ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'}`}>{isCorrect ? 'Correct!' : 'Wrong...'}</h3>
                        </div>

                        {mode !== 'vocab' && currentItem.explanation && (
                            <div className="mb-6 p-4 rounded-xl bg-gray-50 dark:bg-slate-700/50 border border-gray-100 dark:border-slate-600 max-h-40 overflow-y-auto">
                                <span className="block text-xs text-slate-400 uppercase font-bold mb-2 tracking-wider">Ëß£Ë™¨</span>
                                <p className="text-sm leading-relaxed text-slate-700 dark:text-slate-300 selectable-text">{currentItem.explanation}</p>
                            </div>
                        )}
                        
                        <Button onClick={nextQuestion} className="w-full text-lg h-14" variant="primary">
                            Next Question <Icon name="arrow-right" size={20} />
                        </Button>
                    </div>
                </div>
            )}
        </div>
    );
};
        // ==========================================
        // SETTINGS SCREEN
        // ==========================================
        const Settings = ({ settings, updateSettings, onBack, resetData }) => {
            return (
                <div className="flex flex-col h-full bg-gray-50 dark:bg-slate-900 animate-slide-in-right">
                    <Header title="Ë®≠ÂÆö" leftIcon="arrow-left" onLeftClick={onBack} />
                    <div className="p-4 space-y-6">
                        <div className="bg-white dark:bg-slate-800 rounded-2xl p-4 shadow-sm border border-gray-200 dark:border-slate-700">
                            <h3 className="text-xs font-bold text-slate-400 uppercase mb-4 tracking-wider">Ë°®Á§∫„Å®„Çµ„Ç¶„É≥„Éâ</h3>
                            <div className="flex items-center justify-between mb-6">
                                <div className="flex items-center gap-3">
                                    <div className="p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg text-blue-600 dark:text-blue-400"><Icon name={settings.theme === 'dark' ? 'moon' : 'sun'} /></div>
                                    <div><p className="font-bold text-slate-800 dark:text-slate-100">„ÉÄ„Éº„ÇØ„É¢„Éº„Éâ</p><p className="text-xs text-slate-500">ÁõÆ„Å´ÂÑ™„Åó„ÅÑÊöóËâ≤„ÉÜ„Éº„Éû</p></div>
                                </div>
                                <Toggle checked={settings.theme === 'dark'} onChange={() => updateSettings('theme', settings.theme === 'dark' ? 'light' : 'dark')} />
                            </div>
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-3">
                                    <div className="p-2 bg-green-100 dark:bg-green-900/30 rounded-lg text-green-600 dark:text-green-400"><Icon name={settings.sound ? 'volume-2' : 'volume-x'} /></div>
                                    <div><p className="font-bold text-slate-800 dark:text-slate-100">ÂäπÊûúÈü≥</p><p className="text-xs text-slate-500">Êìç‰ΩúÈü≥„Å®Ê≠£Ë™§Âà§ÂÆöÈü≥</p></div>
                                </div>
                                <Toggle checked={settings.sound} onChange={() => updateSettings('sound', !settings.sound)} />
                            </div>
                        </div>

                        <div className="bg-white dark:bg-slate-800 rounded-2xl p-4 shadow-sm border border-gray-200 dark:border-slate-700">
                            <h3 className="text-xs font-bold text-slate-400 uppercase mb-4 tracking-wider">Â≠¶ÁøíË®≠ÂÆö</h3>
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-3">
                                    <div className="p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg text-purple-600 dark:text-purple-400"><Icon name="dumbbell" /></div>
                                    <div><p className="font-bold text-slate-800 dark:text-slate-100">ÁâπË®ì„É¢„Éº„Éâ</p><p className="text-xs text-slate-500">2ÂõûÈÄ£Á∂öÊ≠£Ëß£„Åß„ÄåÁøíÂæóÊ∏à„Åø„Äç</p></div>
                                </div>
                                <Toggle checked={settings.spartan} onChange={() => updateSettings('spartan', !settings.spartan)} />
                            </div>
                        </div>

                        <div className="bg-white dark:bg-slate-800 rounded-2xl p-4 shadow-sm border border-gray-200 dark:border-slate-700">
                            <h3 className="text-xs font-bold text-slate-400 uppercase mb-4 tracking-wider">„Éá„Éº„ÇøÁÆ°ÁêÜ</h3>
                            <Button variant="danger" className="w-full" onClick={resetData}>
                                <Icon name="trash-2" size={18} /> Â≠¶Áøí„Éá„Éº„Çø„Çí„É™„Çª„ÉÉ„Éà
                            </Button>
                        </div>
                        <div className="text-center text-xs text-slate-400 pt-8 pb-4">TOEIC 700  ver 3.1</div>
                    </div>
                </div>
            );
        };

        // ==========================================
// HOME SCREEN (‰øÆÊ≠£Áâà v2)
// ==========================================
const Home = ({ onStart, onSettings }) => {
    const [progress, setProgress] = useState({ mastered: 0, total: 0 }); // ÂàùÊúüÂÄ§„Çí0„Å´

    useEffect(() => {
        // 1. ÂÖ®ÂçòË™û„ÅÆÁ∑èÊï∞„ÇíÂèñÂæó
        const totalVocab = VOCAB_DATA.length;

        // 2. „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„ÅÆÂ≠¶ÁøíË®òÈå≤„ÇíÂèñÂæó
        const saved = JSON.parse(localStorage.getItem('toeic_progress_v3') || '{}');
        
        // 3. VOCAB_DATA „Å´Â≠òÂú®„Åô„ÇãID„Å†„Åë„ÇíÂØæË±°„Å´„ÄÅmastered „Åã„Å©„ÅÜ„Åã„Çí„Ç´„Ç¶„É≥„Éà
        const masteredCount = VOCAB_DATA.reduce((count, item) => {
            const itemData = saved[item.id];
            // „Éá„Éº„Çø„ÅåÂ≠òÂú®„Åó„ÄÅ„Åã„Å§ mastered „Éï„É©„Ç∞„Åå true „Å™„Çâ„Ç´„Ç¶„É≥„Éà
            if (itemData && itemData.mastered) {
                return count + 1;
            }
            return count;
        }, 0);
        
        setProgress({ mastered: masteredCount, total: totalVocab });
    }, []);

    // „Éë„Éº„Çª„É≥„ÉÜ„Éº„Ç∏Ë®àÁÆó
    const percentage = progress.total > 0 ? Math.round((progress.mastered / progress.total) * 100) : 0;

    return (
        // ... (returnÂÜÖ„ÅÆ JSX „Ç≥„Éº„Éâ„ÅØÂ§âÊõ¥„Å™„Åó„Åß„Åù„ÅÆ„Åæ„Åæ‰Ωø„Åà„Åæ„Åô) ...
        <div className="min-h-screen bg-gray-50 dark:bg-slate-900 text-slate-800 dark:text-white p-6 pb-24 transition-colors animate-fade-in">
            <div className="flex justify-between items-center mb-6 pt-2 relative z-20">
                <div className="flex items-center gap-2">
                <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-yellow-400 to-orange-600 flex items-center justify-center text-white font-black text-xs shadow-lg shadow-orange-500/20 transform rotate-3">
                    700
                </div>
                <span className="font-bold text-xl tracking-tight text-slate-800 dark:text-white">TOEIC 700</span>
            </div>
                <button onClick={onSettings} className="p-3 rounded-full bg-white dark:bg-slate-800 shadow-sm border border-gray-200 dark:border-slate-700 btn-press">
                    <Icon name="settings" className="w-5 h-5 text-slate-600 dark:text-slate-400" />
                </button>
            </div>

            {/* COUNTDOWN COMPONENT */}
            <CountdownWidget />

            <div className="flex justify-between items-end mb-6 mx-2">
                <div>
                    <p className="text-sm text-slate-500 dark:text-slate-400 mb-1 font-medium">Weekly Goal</p>
                    <h1 className="text-3xl font-black font-mono gold-text tracking-tighter">7 DAYS</h1>
                </div>
                <div className="text-right">
                    <div className="inline-flex items-center gap-1 bg-yellow-100 dark:bg-yellow-900/30 px-2 py-1 rounded-md border border-yellow-200 dark:border-yellow-500/20">
                        <span className="text-xs font-bold text-yellow-700 dark:text-yellow-500">TARGET SCORE</span>
                    </div>
                    <div className="flex items-baseline justify-end gap-1 mt-1">
                        <span className="text-2xl font-black text-slate-800 dark:text-white">700</span>
                        <span className="text-xs text-slate-500 font-bold">P</span>
                    </div>
                </div>
            </div>

            {/* --- VOCABULARY MASTERY CARD --- */}
            <div className="glass-panel p-6 rounded-3xl mb-8 relative overflow-hidden border border-white dark:border-slate-700 shadow-xl bg-white/60 dark:bg-slate-800/60">
                <div className="absolute -top-4 -right-4 p-4 opacity-5 dark:opacity-10 pointer-events-none transform rotate-12">
                    <Icon name="award" size={120} className="text-yellow-500" />
                </div>
                <div className="relative z-10">
                    <div className="flex justify-between items-center mb-3">
                        <h2 className="text-xs font-bold text-slate-600 dark:text-slate-300 uppercase tracking-wider flex items-center gap-2">
                            <Icon name="bar-chart-2" size={14} /> Vocabulary Mastery
                        </h2>
                        <span className="bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 px-2 py-0.5 rounded text-[10px] font-bold">
                            {percentage}% Completed
                        </span>
                    </div>
                    
                    <div className="flex items-end gap-2 mb-3">
                        <span className="text-5xl font-black text-slate-800 dark:text-white tracking-tighter">{progress.mastered}</span>
                        <span className="text-slate-500 dark:text-slate-400 mb-2 text-sm font-bold">
                             <span className="text-slate-300 mx-1">/</span> {progress.total} Words
                        </span>
                    </div>
                    
                    <div className="w-full bg-gray-200 dark:bg-slate-700 rounded-full h-4 mb-2 overflow-hidden shadow-inner relative">
                        {/* ËÉåÊôØ„ÅÆ„Çπ„Éà„É©„Ç§„ÉóÔºàË£ÖÈ£æÔºâ */}
                        <div className="absolute inset-0 opacity-10 bg-[length:10px_10px] bg-[linear-gradient(45deg,rgba(0,0,0,.1)_25%,transparent_25%,transparent_50%,rgba(0,0,0,.1)_50%,rgba(0,0,0,.1)_75%,transparent_75%,transparent)]"></div>
                        
                        <div 
                            className="bg-gradient-to-r from-yellow-400 to-orange-500 h-full rounded-full transition-all duration-1000 ease-out relative" 
                            style={{ width: `${percentage}%` }}
                        >
                            {/* „Ç≠„É©„ÉÉ„Å®ÂÖâ„Çã„Ç®„Éï„Çß„ÇØ„Éà */}
                            <div className="absolute top-0 right-0 bottom-0 w-1 bg-white/50 blur-[2px]"></div>
                        </div>
                    </div>
                    <p className="text-[10px] text-slate-400 text-right">
                        ÁâπË®ì„É¢„Éº„Éâ„Åß2ÂõûÈÄ£Á∂öÊ≠£Ëß£„Åô„Çã„Å®„Ç´„Ç¶„É≥„Éà„Åï„Çå„Åæ„Åô
                    </p>
                </div>
            </div>

            <h3 className="text-xs font-bold text-slate-400 uppercase mb-4 tracking-wider ml-1">Training Modules</h3>
            <div className="grid grid-cols-2 gap-4">
                <button onClick={() => onStart('vocab')} className="bg-white dark:bg-slate-800 p-5 rounded-2xl text-left border border-gray-200 dark:border-slate-700 shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all duration-300 btn-press group">
                    <div className="bg-yellow-100 dark:bg-yellow-900/30 w-12 h-12 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform duration-300">
                        <Icon name="book-open" className="text-yellow-600 dark:text-yellow-500" />
                    </div>
                    <h3 className="font-bold text-lg mb-1 text-slate-800 dark:text-slate-100">ÈáçË¶ÅÂçòË™û</h3>
                    <p className="text-xs text-slate-500 font-medium">È´òÈÄü„Éû„Çπ„Çø„Éº</p>
                </button>
                <button onClick={() => onStart('reading')} className="bg-white dark:bg-slate-800 p-5 rounded-2xl text-left border border-gray-200 dark:border-slate-700 shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all duration-300 btn-press group">
                    <div className="bg-blue-100 dark:bg-blue-900/30 w-12 h-12 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform duration-300">
                        <Icon name="glasses" className="text-blue-600 dark:text-blue-500" />
                    </div>
                    <h3 className="font-bold text-lg mb-1 text-slate-800 dark:text-slate-100">Reading</h3>
                    <p className="text-xs text-slate-500 font-medium">Part 5.6.7</p>
                </button>
                <button onClick={() => onStart('listening')} className="col-span-2 bg-white dark:bg-slate-800 p-5 rounded-2xl text-left border border-gray-200 dark:border-slate-700 shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all duration-300 btn-press group relative overflow-hidden">
                    <div className="absolute right-0 top-0 w-32 h-full bg-gradient-to-l from-green-50 dark:from-green-900/10 to-transparent"></div>
                    <div className="flex items-center justify-between relative z-10">
                        <div>
                            <div className="bg-green-100 dark:bg-green-900/30 w-12 h-12 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform duration-300">
                                <Icon name="headphones" className="text-green-600 dark:text-green-500" />
                            </div>
                            <h3 className="font-bold text-lg mb-1 text-slate-800 dark:text-slate-100">Listening</h3>
                            <p className="text-xs text-slate-500 font-medium">Part 1.2.3.4</p>
                        </div>
                        <div className="bg-slate-100 dark:bg-slate-700 w-12 h-12 rounded-full flex items-center justify-center shadow-inner group-hover:bg-green-500 group-hover:text-white transition-colors duration-300">
                            <Icon name="play" className="w-5 h-5 ml-1" />
                        </div>
                    </div>
                </button>
            </div>
        </div>
    );
};

        // ==========================================
        // MAIN APP CONTAINER
        // ==========================================
        const App = () => {
            const [view, setView] = useState('home'); // home, settings, course_select_*, quiz_*
            const [activeMode, setActiveMode] = useState(null); 
            const [courseFilter, setCourseFilter] = useState('all'); 
            
            const [settings, setSettings] = useState(() => {
                const saved = localStorage.getItem('toeic_settings_v3');
                return saved ? JSON.parse(saved) : { theme: 'dark', sound: true, spartan: false };
            });

            useEffect(() => {
                if (settings.theme === 'dark') document.documentElement.classList.add('dark');
                else document.documentElement.classList.remove('dark');
                localStorage.setItem('toeic_settings_v3', JSON.stringify(settings));
            }, [settings]);

            

            const updateSettings = (key, value) => setSettings(prev => ({ ...prev, [key]: value }));
            const resetData = () => {
                if(confirm("Â≠¶Áøí„Éá„Éº„Çø„Çí„Åô„Åπ„Å¶„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ")) {
                    localStorage.removeItem('toeic_progress_v3');
                    window.location.reload();
                }
            };

            const handleStartPreSelect = (mode) => {
                setActiveMode(mode);
                setView('course_select');
            };

            const handleCourseSelect = (filterId) => {
                setCourseFilter(filterId);
                setView('quiz');
            };

            const getDataForMode = () => {
                if (activeMode === 'vocab') return VOCAB_DATA;
                if (activeMode === 'reading') return READING_QUESTION_DATA;
                if (activeMode === 'listening') return LISTENING_QUESTION_DATA;
                return [];
            };

            // App „Ç≥„É≥„Éù„Éº„Éç„É≥„ÉàÂÜÖ„ÅÆ return ÈÉ®ÂàÜ„Çí‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å´Êõ∏„ÅçÊèõ„Åà„Å¶„Åè„Å†„Åï„ÅÑ
return (
    <SoundProvider enabled={settings.sound}>
        {/* overflow-hidden „Çí overflow-y-auto „Å´Â§âÊõ¥„Åó„ÄÅ„Çπ„ÇØ„É≠„Éº„É´ÂèØËÉΩ„Å´„Åó„Åæ„Åô */}
        <div className="max-w-md mx-auto h-full bg-gray-50 dark:bg-slate-900 shadow-2xl relative overflow-y-auto overflow-x-hidden">
            {view === 'home' && <Home onStart={handleStartPreSelect} onSettings={() => setView('settings')} />}
            
            {/* „Åù„ÅÆ‰ªñ„ÅÆ„Ç≥„É≥„Éù„Éº„Éç„É≥„ÉàË°®Á§∫„É≠„Ç∏„ÉÉ„ÇØ„ÅØ„Åù„ÅÆ„Åæ„Åæ... */}
            {view === 'settings' && (
                <Settings settings={settings} updateSettings={updateSettings} onBack={() => setView('home')} resetData={resetData} />
            )}

            {view === 'course_select' && (
                <CourseSelection type={activeMode} onSelect={handleCourseSelect} onBack={() => setView('home')} />
            )}

            {view === 'quiz' && (
                <QuizSession 
                    rawData={getDataForMode()} 
                    mode={activeMode} 
                    filterId={courseFilter}
                    isDrillMode={settings.spartan} 
                    onFinish={() => setView('course_select')}
                />
            )}
        </div>
    </SoundProvider>
);
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
